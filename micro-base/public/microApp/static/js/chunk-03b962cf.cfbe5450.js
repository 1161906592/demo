(window["webpackJsonpmicro_name_"]=window["webpackJsonpmicro_name_"]||[]).push([["chunk-03b962cf"],{"067e":function(e,t,s){"use strict";var a=s("c918"),r=s.n(a);r.a},"11e6":function(e,t,s){},"4c2b":function(e,t,s){},8738:function(e,t,s){"use strict";var a=s("ea4b"),r=s.n(a);r.a},"8b84":function(e,t,s){"use strict";var a=s("11e6"),r=s.n(a);r.a},"978b":function(e,t,s){},"9e53":function(e,t,s){"use strict";var a=s("4c2b"),r=s.n(a);r.a},a169:function(e,t,s){"use strict";var a=s("978b"),r=s.n(a);r.a},b70c:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"my-main"},[s("div",{staticClass:"step"},[s("el-steps",{attrs:{space:300,active:e.state,"finish-status":"success","align-center":""}},[s("el-step",{attrs:{title:"流程设计"}}),s("el-step",{attrs:{title:"权限设置"}}),s("el-step",{attrs:{title:"表单设计"}}),s("el-step",{attrs:{title:"发布"}})],1),s("el-button",{staticStyle:{position:"absolute",right:"20px",top:"20px","z-index":"99"},attrs:{size:"small"},on:{click:e.handleCancel}},[e._v("返回 ")])],1),0===e.state?[s("flow-chart-design",{attrs:{"procdef-id":e.currentData?e.currentData.procdefId:""},on:{complete:e.flowChartSaved}})]:e._e(),1===e.state?[s("role-set",{attrs:{"procdef-key":e.currentData.procdefKey,type:e.typeId||""},on:{"data-load":e.saveProcessRoleList},model:{value:e.processRoleSet,callback:function(t){e.processRoleSet=t},expression:"processRoleSet"}})]:e._e(),2===e.state?[s("form-design",{ref:"formDesign",attrs:{"procdef-key":e.currentData.procdefKey},on:{"data-load":e.saveProcessFormList},model:{value:e.processFormSet,callback:function(t){e.processFormSet=t},expression:"processFormSet"}})]:e._e(),3===e.state?[s("task-assignment",{ref:"assignment",attrs:{"procdef-key":e.currentData.procdefKey,"procdef-id":e.currentData.procdefId,"data-list":e.someRequestData}})]:e._e(),s("div",{staticClass:"btn"},[0!==e.state?s("el-button",{attrs:{size:"small"},on:{click:e.handlePrev}},[e._v("上一步")]):e._e(),0===e.state&&"{}"!==JSON.stringify(e.currentData)||1===e.state||2===e.state?s("el-button",{attrs:{size:"small",type:"primary",disabled:!e.currentData},on:{click:function(t){e.currentData&&e.handleNext()}}},[e._v("\n      下一步\n    ")]):e._e(),3===e.state?s("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleRelease}},[e._v("\n      发布\n    ")]):e._e()],1)],2)},r=[],i=(s("ac6a"),s("5df3"),s("96cf"),s("3b8d")),n=s("d225"),o=s("b0b4"),l=s("308d"),c=s("6bb5"),u=s("4e2b"),p=s("9ab4"),m=s("60a3"),d=s("e129"),f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-body"},[s("div",{staticClass:"header-buttons"},[e.changeFileStatus?s("el-upload",{ref:"process-upload",staticStyle:{display:"inline-block","margin-left":"20px"},attrs:{action:e.uploadProcessFileUrl,data:e.uploadParam,"show-file-list":!1,headers:e.httpHeaders,"before-upload":function(){return!0},"on-success":e.handleUploadFileSuccess,"on-error":e.handleUploadFileSuccess,"on-change":e.fileChanged,"auto-upload":!1,multiple:"",limit:1,"file-list":e.processFileList}},[s("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("直接导入")])],1):e._e(),e.procdefIdSelf&&!e.reDesign?s("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"mini"},on:{click:e.handleReDesign}},[e._v("重新设计 ")]):e._e()],1),!e.procdefIdSelf||e.reDesign?s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.frameLoading,expression:"frameLoading"}],staticClass:"iframe"},[s("iframe",{ref:"iframe",attrs:{src:e.bpmnPath,frameborder:"0",width:"100%",height:"100%"}})]):s("div",[s("img",{ref:"processImg",attrs:{"process-src":e.getProcessImage+"?procId="+e.procdefIdSelf,alt:""}})])])},g=[],h=(s("7f7f"),s("c195")),v=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.procdefIdSelf="",e.httpHeaders={accessToken:"Bearer "+h["a"].get("accessToken")},e.uploadProcessFileUrl=d["a"].processManage.uploadProcessFile,e.uploadParam={importState:0},e.processFile=null,e.processFileList=[],e.bpmnPath="/microApp/static/bpmn/index.html",e.getProcessImage=d["a"].processManage.getProcessImage,e.frameLoading=!1,e.loading=!1,e.reDesign=!1,e.changeFileStatus=!0,e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"mounted",value:function(){this.procdefId?(this.procdefIdSelf=this.procdefId,this.loadProcessImg()):this.initIframe(),this.frameLoading=!1}},{key:"loadProcessImg",value:function(){var e=this;this.$nextTick((function(){var t=e.$refs["processImg"],s=t.getAttribute("process-src"),a=new XMLHttpRequest,r=h["a"].get("accessToken");a.responseType="blob",a.open("get",s,!0),a.setRequestHeader("accessToken","Bearer "+r),a.onreadystatechange=function(e){a.readyState==XMLHttpRequest.DONE&&200==a.status&&(t.src=URL.createObjectURL(a.response),t.onload=function(){URL.revokeObjectURL(t.src)})},a.send(null)}))}},{key:"handleReDesign",value:function(){this.reDesign=!0,this.initIframe()}},{key:"initIframe",value:function(){var e=this;this.frameLoading=!0,this.$nextTick((function(){var t=e.$refs.iframe;t.contentWindow.addEventListener("load",(function(){e.frameLoading=!1,t.contentWindow.createNewDiagram()})),t.contentWindow.finish=function(t){e.saveProcessFile(t,0)}}))}},{key:"saveProcessFile",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,s){var a,r,i,n,o,l=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.$http.post(d["a"].processManage.saveProcessFile,{text:t,importState:s});case 4:a=e.sent,r=a.data,i=r.data,n=r.status,o=r.message,n?400===i.code?this.$confirm(i.message,"提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){console.log(!0),l.saveProcessFile(t,1)})):(this.$message.success("导入成功"),this.getProcdefById(i.data)):this.$message.error(o);case 10:return e.prev=10,this.loading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[1,,10,13]])})));function t(t,s){return e.apply(this,arguments)}return t}()},{key:"handleUploadFileSuccess",value:function(e,t,s){var a=this;e.status?400===e.data.code?(this.$refs["process-upload"].clearFiles(),this.processFileList=[],this.$confirm(e.data.message,"提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.uploadParam={importState:1},a.processFileList.push(a.processFile),a.$nextTick((function(){a.$refs["process-upload"].submit()}))}))):(this.$message.success("导入成功"),this.uploadParam={importState:0},this.getProcdefById(e.data.data)):this.$message.error(e.message)}},{key:"getProcdefById",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var s,a,r,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(d["a"].processManage.getProcdefById,{params:{id:t}});case 2:s=e.sent,a=s.data,r=a.data,i=a.status,n=a.message,i?this.$emit("complete",r):this.$message.error(n);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"fileChanged",value:function(e){this.processFile={name:e.name+"-reUpload",raw:e.raw,size:e.size,status:"ready",uid:e.uid},this.$refs["process-upload"].submit()}}]),t}(m["e"]);p["__decorate"]([Object(m["d"])({type:String,required:!1})],v.prototype,"procdefId",void 0),v=p["__decorate"]([Object(m["a"])({})],v);var b=v,y=b,I=(s("067e"),s("2877")),k=Object(I["a"])(y,f,g,!1,null,"5c09eec3",null),x=k.exports,R=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-body"},[s("div",{staticClass:"process-type"},[s("div",{staticStyle:{"font-size":"14px","line-height":"36px"}},[e._v("选择分类：")]),s("el-select",{staticStyle:{width:"calc(30% - 68px)","min-width":"412px"},attrs:{placeholder:"请选择",clearable:"",size:"medium"},on:{change:e.returnData},model:{value:e.typeId,callback:function(t){e.typeId=t},expression:"typeId"}},e._l(e.typeOptions,(function(e,t){return s("el-option",{key:t,attrs:{label:e.procdefTypeName,value:e.id}})})),1)],1),s("div",{staticClass:"transfer-body"},[s("div",{staticClass:"transfer-item"},[s("div",{staticClass:"transfer-title"},[e._v("可见组织：")]),s("el-transfer",{attrs:{filterable:"",data:e.invisibleOrgList,titles:["组织列表","已选组织"],props:{key:"id",label:"name"}},on:{change:e.returnData},model:{value:e.orgValue,callback:function(t){e.orgValue=t},expression:"orgValue"}})],1),s("div",{staticClass:"transfer-item"},[s("div",{staticClass:"transfer-title"},[e._v("可见角色：")]),s("el-transfer",{attrs:{filterable:"",data:e.invisibleRoleList,titles:["角色列表","已选角色"],props:{key:"id",label:"name"}},on:{change:e.returnData},model:{value:e.roleValue,callback:function(t){e.roleValue=t},expression:"roleValue"}})],1),s("div",{staticClass:"transfer-item"},[s("div",{staticClass:"transfer-title"},[e._v("可见用户：")]),s("el-transfer",{attrs:{filterable:"",data:e.invisibleUserList,titles:["用户列表","已选用户"],props:{key:"id",label:"name"}},on:{change:e.returnData},model:{value:e.userValue,callback:function(t){e.userValue=t},expression:"userValue"}})],1)])])},w=[],L=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.loading=!0,e.typeId=e.type||"",e.typeOptions=[],e.invisibleOrgList=[],e.invisibleRoleList=[],e.invisibleUserList=[],e.orgValue=[],e.roleValue=[],e.userValue=[],e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.loadData()}},{key:"mounted",value:function(){}},{key:"loadData",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([this.getAllProcessType(),this.getInvisibleDataList(d["a"].processManage.getAllOrg,"invisibleOrgList","orgId","orgName"),this.getInvisibleDataList(d["a"].processManage.getAllRole,"invisibleRoleList","roleId","roleName"),this.getInvisibleDataList(d["a"].processManage.getAllUser,"invisibleUserList","userId","userName"),this.getVisibleDataList(d["a"].processManage.getProcessVisibleOrg,"orgValue","orgId"),this.getVisibleDataList(d["a"].processManage.getProcessVisibleRole,"roleValue","roleId"),this.getVisibleDataList(d["a"].processManage.getProcessVisiblePerson,"userValue","userId")]);case 3:return e.prev=3,this.loading=!1,this.$emit("data-load",{orgList:this.invisibleOrgList,roleList:this.invisibleRoleList,userList:this.invisibleUserList}),this.returnData(),e.finish(3);case 8:case"end":return e.stop()}}),e,this,[[0,,3,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"returnData",value:function(){var e={orgValue:this.orgValue,roleValue:this.roleValue,userValue:this.userValue,type:this.typeId};this.$emit("input",e)}},{key:"getAllProcessType",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s,a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(this.typeId.length?"".concat(d["a"].processManage.getAllProcessTypeWithDelete).concat(this.typeId):d["a"].processManage.getAllProcessType);case 2:t=e.sent,s=t.data,a=s.data,r=s.status,i=s.message,r?this.typeOptions=a:this.$message.error(i);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getInvisibleDataList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,s,a,r){var i,n,o,l,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(t,{params:{procdefKey:this.procdefKey}});case 2:i=e.sent,n=i.data,o=n.data,l=n.status,c=n.message,l?this[s]=o.map((function(e){return{id:e[a],name:e[r]}})):this.$message.error(c);case 8:case"end":return e.stop()}}),e,this)})));function t(t,s,a,r){return e.apply(this,arguments)}return t}()},{key:"getVisibleDataList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,s,a){var r,i,n,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(t,{params:{procdefKey:this.procdefKey}});case 2:r=e.sent,i=r.data,n=i.data,o=i.status,l=i.message,o?this[s]=n.map((function(e){return e[a]})):this.$message.error(l);case 8:case"end":return e.stop()}}),e,this)})));function t(t,s,a){return e.apply(this,arguments)}return t}()}]),t}(m["e"]);p["__decorate"]([Object(m["d"])({type:String,required:!0})],L.prototype,"procdefKey",void 0),p["__decorate"]([Object(m["d"])({type:String,required:!0})],L.prototype,"type",void 0),p["__decorate"]([Object(m["c"])("input")],L.prototype,"processRole",void 0),L=p["__decorate"]([Object(m["a"])({})],L);var O=L,D=O,P=(s("8738"),Object(I["a"])(D,R,w,!1,null,null,null)),T=P.exports,$=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-body"},[s("div",{staticClass:"inline"},[s("div",{staticClass:"label"},[e._v("使用模板：")]),s("el-switch",{model:{value:e.useTemp,callback:function(t){e.useTemp=t},expression:"useTemp"}})],1),e.useTemp?s("div",{staticClass:"inline"},[s("div",{staticClass:"label"},[e._v("模板选择：")]),s("el-select",{staticStyle:{width:"calc(100% - 100px)"},attrs:{placeholder:"请选择",clearable:"",size:"small"},on:{change:e.handleSelectForm},model:{value:e.formId,callback:function(t){e.formId=t},expression:"formId"}},e._l(e.formList,(function(e,t){return s("el-option",{key:t,attrs:{label:e.formName,value:e.id}})})),1)],1):e._e(),e.useTemp?e._e():[s("el-form",{ref:"form",staticStyle:{width:"100%"},attrs:{size:"small",model:e.form,rules:e.formRules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"表单名称：",prop:"formName"}},[s("el-input",{attrs:{size:"small",placeholder:"请输入",maxlength:50},model:{value:e.form.formName,callback:function(t){e.$set(e.form,"formName",t)},expression:"form.formName"}},[s("el-button",{attrs:{slot:"append"},on:{click:e.checkFormName},slot:"append"},[e._v("名称验证")])],1)],1)],1),s("el-form",{ref:"optionItemForm",staticStyle:{width:"100%"},attrs:{model:e.optionItem,size:"small","label-width":"100px",rules:e.rules}},[s("el-form-item",{attrs:{label:"项目标题：",prop:"name"}},[s("el-input",{attrs:{maxlength:7,placeholder:"请输入(不超过7个字符)"},model:{value:e.optionItem.name,callback:function(t){e.$set(e.optionItem,"name",t)},expression:"optionItem.name"}})],1),s("el-form-item",{attrs:{label:"数据项类型：",prop:"attrType"}},[s("el-select",{staticClass:"inpW",attrs:{placeholder:"请选择"},on:{change:e.typeChange},model:{value:e.optionItem.attrType,callback:function(t){e.$set(e.optionItem,"attrType",t)},expression:"optionItem.attrType"}},e._l(e.typeOptions,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e.optionItem.attrType&&"location"!==e.optionItem.attrType?s("el-form-item",{attrs:{label:"选项设置："}},["select"===e.optionItem.attrType||"multiSelect"===e.optionItem.attrType?s("div",[e._l(e.optionItem.dataRange.options,(function(t,a){return s("el-row",{key:a,staticStyle:{"margin-bottom":"6px"}},[s("el-col",{attrs:{span:15}},[s("el-input",{attrs:{size:"small",maxlength:100,clearable:""},model:{value:t.content,callback:function(s){e.$set(t,"content",s)},expression:"optionsItem.content"}})],1),s("el-col",{attrs:{span:6}},[s("el-checkbox",{staticStyle:{"margin-left":"20px"},on:{change:function(t){return e.handleCheck(a)}},model:{value:t.defaultChosen,callback:function(s){e.$set(t,"defaultChosen",s)},expression:"optionsItem.defaultChosen"}},[e._v("默认选中")])],1),s("el-col",{attrs:{span:3}},[s("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return t.preventDefault(),e.removeOptionItem(a)}}})],1)],1)})),s("el-row",[s("el-button",{staticStyle:{float:"left"},attrs:{type:"text"},on:{click:e.addOptionItem}},[s("i",{staticClass:"font_family icon-xinzenglanse"}),e._v("\n              添加选项\n            ")])],1)],2):"number"===e.optionItem.attrType?s("div",[s("el-row",[s("el-input-number",{attrs:{precision:2,placeholder:"最小值",max:e.optionItem.dataRange.numMax},model:{value:e.optionItem.dataRange.numMin,callback:function(t){e.$set(e.optionItem.dataRange,"numMin",t)},expression:"optionItem.dataRange.numMin"}}),s("span",[e._v("  至  ")]),s("el-input-number",{attrs:{precision:2,placeholder:"最大值",min:e.optionItem.dataRange.numMin},model:{value:e.optionItem.dataRange.numMax,callback:function(t){e.$set(e.optionItem.dataRange,"numMax",t)},expression:"optionItem.dataRange.numMax"}})],1)],1):"image"===e.optionItem.attrType?s("div",[s("el-row",[s("span",[e._v("最大张数  ")]),s("el-input-number",{attrs:{precision:0,min:1,max:9,placeholder:"最大张数"},model:{value:e.optionItem.dataRange.imgMaxNum,callback:function(t){e.$set(e.optionItem.dataRange,"imgMaxNum",t)},expression:"optionItem.dataRange.imgMaxNum"}})],1)],1):"text"===e.optionItem.attrType||"textarea"===e.optionItem.attrType?s("div",[s("el-row",[s("el-input",{attrs:{size:"small",placeholder:"预设文本",maxlength:300,clearable:""},model:{value:e.optionItem.dataRange.presetText,callback:function(t){e.$set(e.optionItem.dataRange,"presetText",t)},expression:"optionItem.dataRange.presetText"}})],1)],1):"location"===e.optionItem.attrType?s("div",[s("el-row",[s("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"定位地址",disabled:""},model:{value:e.optionItem.dataRange.position,callback:function(t){e.$set(e.optionItem.dataRange,"position",t)},expression:"optionItem.dataRange.position"}})],1)],1):e._e()]):e._e(),"number"===e.optionItem.attrType?s("el-form-item",{attrs:{label:"数值单位："}},[s("el-input",{attrs:{maxlength:10,clearable:""},model:{value:e.optionItem.dataRange.unit,callback:function(t){e.$set(e.optionItem.dataRange,"unit",t)},expression:"optionItem.dataRange.unit"}})],1):e._e(),s("el-form-item",{staticStyle:{"text-align":"right"}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:e.handleAddItem}},[e._v("\n          添加\n        ")])],1)],1)],s("div",{staticClass:"hr"}),s("q-custom-input",{attrs:{"custom-options":e.form.formItems,disabled:"",closable:!e.useTemp,"line-size":1,size:"mini"}})],2)},_=[],S=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.useTemp=!1,e.loading=!0,e.searchFormName="",e.formList=[],e.formId="",e.form={formName:"",formItems:[],formNameStatus:!1},e.formRules={formName:{required:!0,message:"请输入表单名称",trigger:"blur"}},e.rules={name:[{required:!0,message:"请输入项目标题",trigger:"blur"},{validator:function(t,s,a){if(e.form.formItems.some((function(e){return e.name===s})))return a(new Error("项目标题不要重复"));a()},trigger:"blur"}]},e.typeOptions=[{value:"select",label:"单项选择"},{value:"multiSelect",label:"多项选择"},{value:"number",label:"数值"},{value:"image",label:"图片"},{value:"text",label:"文本"},{value:"textarea",label:"多行文本"},{value:"location",label:"定位"},{value:"link",label:"网页链接"}],e.optionItem={name:"",attrType:"",value:"",dataRange:{options:[],multiSelectedItems:[]}},e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){var e=this;this.getAllFormList().then((function(){e.getFormByProcess().finally((function(){return e.loading=!1}))}))}},{key:"getFormByProcess",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(d["a"].processManage.getProcdefByKey,{params:{procdefKey:this.procdefKey}});case 2:t=e.sent,s=t.data,a=s.data,r=s.status,s.message,r&&a.formId?(this.formId=a.formId,this.useTemp=!0):this.useTemp=!1;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAllFormList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s,a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(d["a"].formManage.getFormList,{params:{formName:this.searchFormName,size:999999,current:1}});case 2:t=e.sent,s=t.data,a=s.data,r=s.status,i=s.message,r?(this.formList=a.records,this.$emit("data-load",this.formList)):this.$message.error(i);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleSelectForm",value:function(e){this.form=this.formList.filter((function(t){return t.id===e}))[0],this.form.formNameStatus=!0,this.form.formItems=JSON.parse(this.form.formDef)}},{key:"checkFormName",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s,a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(d["a"].formManage.checkFormName,{params:{formName:this.form.formName}});case 2:t=e.sent,s=t.data,a=s.data,r=s.status,i=s.message,r?a?(this.form.formNameStatus=!0,this.$message.success("表单名称可用")):(this.form.formNameStatus=!1,this.$message.warning("表单名称已使用")):this.$message.error(i);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"typeChange",value:function(){"select"===this.optionItem.attrType||"multiSelect"===this.optionItem.attrType?(this.optionItem.dataRange.options=[],this.optionItem.dataRange.multiSelectedItems=[]):"number"===this.optionItem.attrType?(this.$set(this.optionItem.dataRange,"numMin",0),this.$set(this.optionItem.dataRange,"numMax",10),this.$set(this.optionItem.dataRange,"unit","")):"text"===this.optionItem.attrType?this.$set(this.optionItem.dataRange,"presetText",""):"image"===this.optionItem.attrType&&this.$set(this.optionItem.dataRange,"imgMaxNum",1)}},{key:"handleCheck",value:function(e){if(this.optionItem.dataRange.options[e].defaultChosen&&"select"===this.optionItem.attrType){for(var t in this.optionItem.dataRange.options)this.optionItem.dataRange.options[t].defaultChosen=!1;this.optionItem.dataRange.options[e].defaultChosen=!0}}},{key:"removeOptionItem",value:function(e){this.optionItem.dataRange.options.splice(e,1)}},{key:"addOptionItem",value:function(){"select"===this.optionItem.attrType||"multiSelect"===this.optionItem.attrType?this.optionItem.dataRange.options.push({content:"",defaultChosen:!1}):this.optionItem.dataRange.options.push({})}},{key:"handleAddItem",value:function(){var e=this;this.$refs["optionItemForm"].validate((function(t){t&&(e.$refs["optionItemForm"].clearValidate(),e.form.formItems.push(JSON.parse(JSON.stringify(e.optionItem))),e.optionItem={name:"",attrType:"",value:"",dataRange:{options:[],multiSelectedItems:[]}},e.returnData())}))}},{key:"returnData",value:function(){this.$emit("input",{mode:this.useTemp,form:this.form})}},{key:"handleChangeTemp",value:function(e){e?this.formId&&this.handleSelectForm(this.formId):this.form={formName:"",formItems:[],formNameStatus:!1},this.returnData()}},{key:"handleChangeForm",value:function(){this.returnData()}},{key:"save",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var s,a,r,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,this.form.formName){e.next=4;break}return this.$message.error("请输入表单名称"),e.abrupt("return",t());case 4:if(this.form.formItems.length){e.next=7;break}return this.$message.error("请添加项目"),e.abrupt("return",t());case 7:if(this.form.formNameStatus){e.next=10;break}return this.$message.error("请先验证名称是否可用"),e.abrupt("return",t());case 10:return e.next=12,this.$http.post(d["a"].formManage.insertFormDefine,{formName:this.form.formName,formDef:JSON.stringify(this.form.formItems)});case 12:s=e.sent,a=s.data,r=a.data,i=a.status,n=a.message,i?t(r):(this.$message.error(n),t()),e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](0),t();case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t){return e.apply(this,arguments)}return t}()}]),t}(m["e"]);p["__decorate"]([Object(m["d"])({type:String,required:!0})],S.prototype,"procdefKey",void 0),p["__decorate"]([Object(m["f"])("useTemp",{immediate:!0})],S.prototype,"handleChangeTemp",null),p["__decorate"]([Object(m["f"])("form",{deep:!0})],S.prototype,"handleChangeForm",null),S=p["__decorate"]([Object(m["a"])({})],S);var F=S,j=F,N=(s("9e53"),Object(I["a"])(j,$,_,!1,null,"4513f13a",null)),C=N.exports,M=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-body"},[e._m(0),s("div",{staticStyle:{margin:"20px 0","box-sizing":"border-box"},style:{height:53*(e.assignList.length+1)+"px"}},[s("el-table",{attrs:{data:e.assignList,size:"mini",stripe:""}},[s("el-table-column",{attrs:{align:"center",property:"userTask.name",label:"任务名"}}),s("el-table-column",{attrs:{align:"center",label:"指派人"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-select",{attrs:{size:"mini",filterable:"",clearable:"","reserve-keyword":"",multiple:"",placeholder:"请输入姓名"},model:{value:t.row.userIds,callback:function(s){e.$set(t.row,"userIds",s)},expression:"scope.row.userIds"}},e._l(e.invisibleUserList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),s("el-table-column",{attrs:{align:"center",label:"指派组"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-select",{attrs:{size:"mini","reserve-keyword":"",clearable:"",filterable:"",multiple:"",placeholder:"请输入组织名"},on:{change:function(t){return e.$forceUpdate()}},model:{value:t.row.orgIds,callback:function(s){e.$set(t.row,"orgIds",s)},expression:"scope.row.orgIds"}},e._l(e.invisibleOrgList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),s("el-table-column",{attrs:{align:"center",label:"指派角色"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-select",{attrs:{size:"mini",filterable:"",clearable:"",multiple:"",placeholder:"请选择"},model:{value:t.row.roleIds,callback:function(s){e.$set(t.row,"roleIds",s)},expression:"scope.row.roleIds"}},e._l(e.invisibleRoleList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),s("el-table-column",{attrs:{align:"center",label:"指派表单"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-select",{attrs:{size:"small",clearable:"",filterable:"",placeholder:"请选择"},model:{value:t.row.formId,callback:function(s){e.$set(t.row,"formId",s)},expression:"scope.row.formId"}},e._l(e.formList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.formName,value:e.id}})})),1)]}}])})],1)],1)])},V=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"tip-bar"},[s("i",{staticClass:"el-icon-info",staticStyle:{color:"#fadb14"}}),e._v("每个任务节点必须指派！")])}],A=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.loading=!0,e.assignList=[],e.formList=[],e.invisibleOrgList=[],e.invisibleRoleList=[],e.invisibleUserList=[],e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){var e=this;this.dataList?(this.dataList.invisibleOrgList?this.invisibleOrgList=this.dataList.invisibleOrgList:this.getInvisibleDataList(d["a"].processManage.getAllOrg,"invisibleOrgList","orgId","orgName"),this.dataList.invisibleRoleList?this.invisibleRoleList=this.dataList.invisibleRoleList:this.getInvisibleDataList(d["a"].processManage.getAllRole,"invisibleRoleList","roleId","roleName"),this.dataList.invisibleUserList?this.invisibleUserList=this.dataList.invisibleUserList:this.getInvisibleDataList(d["a"].processManage.getAllUser,"invisibleUserList","userId","userName"),this.dataList.processFormList?this.formList=this.dataList.processFormList:this.getAllFormList(),this.getAssignTaskList().then((function(){return e.loading=!1}))):this.loadData()}},{key:"loadData",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([this.getInvisibleDataList(d["a"].processManage.getAllOrg,"invisibleOrgList","orgId","orgName"),this.getInvisibleDataList(d["a"].processManage.getAllRole,"invisibleRoleList","roleId","roleName"),this.getInvisibleDataList(d["a"].processManage.getAllUser,"invisibleUserList","userId","userName"),this.getAllFormList(),this.getAssignTaskList()]);case 3:return e.prev=3,this.loading=!1,e.finish(3);case 6:case"end":return e.stop()}}),e,this,[[0,,3,6]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAssignTaskList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s,a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(d["a"].processManage.getAssignTaskList,{params:{processDefineId:this.procdefId}});case 2:t=e.sent,s=t.data,a=s.data,r=s.status,i=s.message,r?(a.shift(),this.assignList=a):this.$message.error(i);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAllFormList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s,a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(d["a"].formManage.getFormList,{params:{size:999999,current:1}});case 2:t=e.sent,s=t.data,a=s.data,r=s.status,i=s.message,r?(this.formList=a.records,this.$emit("data-load",this.formList)):this.$message.error(i);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getInvisibleDataList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,s,a,r){var i,n,o,l,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get(t,{params:{procdefKey:this.procdefKey}});case 2:i=e.sent,n=i.data,o=n.data,l=n.status,c=n.message,l?this[s]=o.map((function(e){return{id:e[a],name:e[r]}})):this.$message.error(c);case 8:case"end":return e.stop()}}),e,this)})));function t(t,s,a,r){return e.apply(this,arguments)}return t}()},{key:"saveUserTaskDesignator",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=!0,e.abrupt("return",new Promise(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(a,r){var i,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.checkUserTaskDesign();case 3:if(i=e.sent,!i.every((function(e){return e.status}))){e.next=12;break}return e.next=7,s.$http.post(d["a"].processManage.saveUserTaskDesignator,i);case 7:n=e.sent,o=n.data.status,o?s.$http.get(d["a"].processManage.updateProcessStatus,{params:{procdefKey:s.procdefKey,status:1}}).then((function(e){e.data.status?(s.$message.success("发布成功"),a({status:!0})):(s.$message.error(e.data.message),o=!1,r({status:!1}))})):r({status:!1}),e.next=15;break;case 12:s.$message.error("节点指派不能为空"),t=!1,r({status:!1});case 15:return e.abrupt("return",t);case 18:e.prev=18,e.t0=e["catch"](0),r({status:!1});case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,s){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"checkUserTaskDesign",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.assignList.map((function(e){return e.userIds.length||e.roleIds.length||e.orgIds.length?{status:!0,formId:e.formId,processDefineId:s.procdefId,userTaskId:e.userTask.id,personIds:e.userIds,roleIds:e.roleIds,orgIds:e.orgIds,assignedGroupId:e.userTask.candidateGroups[0],collectionType:"UNION"}:{status:!1}})),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),t}(m["e"]);p["__decorate"]([Object(m["d"])({type:String,required:!0})],A.prototype,"procdefId",void 0),p["__decorate"]([Object(m["d"])({type:String,required:!0})],A.prototype,"procdefKey",void 0),p["__decorate"]([Object(m["d"])({type:Object,required:!0})],A.prototype,"dataList",void 0),A=p["__decorate"]([Object(m["a"])({})],A);var U=A,z=U,K=(s("8b84"),Object(I["a"])(z,M,V,!1,null,"1968a3c0",null)),B=K.exports,q=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.currentData=null,e.typeId="",e.state=0,e.someRequestData={invisibleOrgList:[],invisibleRoleList:[],invisibleUserList:[],processFormList:[]},e.processRoleSet=null,e.processFormSet=null,e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.currentData=this.$route.query.item?JSON.parse(this.$route.query.item+""):{},this.typeId="{}"!==JSON.stringify(this.currentData)?this.currentData.typeId:""}},{key:"handleNext",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==this.state){e.next=3;break}return this.state++,e.abrupt("return",!0);case 3:if(1!==this.state){e.next=14;break}return e.prev=4,e.next=7,Promise.all([this.saveProcessRole(d["a"].processManage.saveProcessVisibleOrg,this.processRoleSet.orgValue,"可见组织"),this.saveProcessRole(d["a"].processManage.saveProcessVisibleRole,this.processRoleSet.roleValue,"可见角色"),this.saveProcessRole(d["a"].processManage.saveProcessVisibleUser,this.processRoleSet.userValue,"可见用户"),this.saveProcessType()]);case 7:return this.state++,e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e["catch"](4),e.abrupt("return",!1);case 14:2===this.state&&this.saveProcessForm().then((function(){t.state++})),3===this.state&&console.log(this.processFormSet);case 16:case"end":return e.stop()}}),e,this,[[4,11]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"flowChartSaved",value:function(e){this.currentData=e,this.handleNext()}},{key:"saveProcessRole",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,s,a){var r,i,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.post(t,{procdefKey:this.currentData.procdefKey,ids:s});case 2:if(r=e.sent,i=r.data,i.data,n=i.status,o=i.message,!n){e.next=11;break}return e.abrupt("return",!0);case 11:this.$message.warning(a+"保存失败，错误原因："+o);case 12:case"end":return e.stop()}}),e,this)})));function t(t,s,a){return e.apply(this,arguments)}return t}()},{key:"saveProcessRoleList",value:function(e){this.someRequestData.invisibleOrgList=e.orgList,this.someRequestData.invisibleRoleList=e.roleList,this.someRequestData.invisibleUserList=e.userList}},{key:"saveProcessType",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.post(d["a"].processManage.updateProcessType,{id:this.currentData.id,typeId:this.processRoleSet.type});case 2:if(t=e.sent,s=t.data,s.data,a=s.status,r=s.message,!a){e.next=12;break}return this.typeId=this.processRoleSet.type,e.abrupt("return",!0);case 12:this.$message.error("流程类型保存失败，错误原因："+r);case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"saveProcessFormList",value:function(e){this.someRequestData.processFormList=e}},{key:"saveProcessForm",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,s){t.processFormSet.mode?e(t.saveFormById()):t.$refs.formDesign.save(function(){var a=Object(i["a"])(regeneratorRuntime.mark((function a(r){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!r){a.next=8;break}return a.t0=e,a.next=4,t.saveFormById(r);case 4:a.t1=a.sent,(0,a.t0)(a.t1),a.next=9;break;case 8:s();case 9:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())})));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"saveFormById",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var s,a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.post(d["a"].processManage.saveProcessForm,{procdefKey:this.currentData.procdefKey,formId:t||this.processFormSet.form.id});case 2:if(s=e.sent,a=s.data,a.data,r=a.status,i=a.message,!r){e.next=11;break}return e.abrupt("return",!0);case 11:return this.$message.error(i),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleRelease",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$refs.assignment.saveUserTaskDesignator();case 2:t=e.sent,s=t.status,s&&this.$router.back();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"handlePrev",value:function(){this.state--}},{key:"handleCancel",value:function(){var e=this;this.$confirm("流程未编辑完成，直接返回会导致流程无法使用，是否返回？","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.back()}))}}]),t}(m["e"]);q=p["__decorate"]([Object(m["a"])({components:{TaskAssignment:B,FormDesign:C,RoleSet:T,FlowChartDesign:x}})],q);var E=q,J=E,W=(s("a169"),Object(I["a"])(J,a,r,!1,null,"e9fc86f8",null));t["default"]=W.exports},c918:function(e,t,s){},e129:function(e,t,s){"use strict";var a={formManage:{getFormList:"/admin/formdesigner/getFormList",delFormDefine:"/admin/formdesigner/delFormDefine",getEventType:"/api/eventType/getEventType",checkFormName:"/admin/formdesigner/checkFormName",updateFormDefine:"/admin/formdesigner/updateFormDefine",insertFormDefine:"/admin/formdesigner/insertFormDefine",getFormDefine:"/admin/formdesigner/getFormDefine"},processManage:{getAllProcessType:"/admin/processType/procdeftype/findAll",getAllProcessTypePaging:"/admin/processType/paging",getPageProcess:"/admin/processDesigner/manager/process/pagingProcessDefineInfo",deleteProcdefInfo:"/admin/processDesigner/manager/process/deleteProcdefInfo",addProcessType:"/admin/processType/procdeftype/insert",deleteProcessType:"/admin/processType/procdeftype/delete/",saveProcessFile:"/admin/processDesigner/manager/file/saveProcessFile",uploadProcessFile:"/admin/processDesigner/manager/file/uploadProcessFile",getAllProcess:"/admin/processDesigner/manager/process/getAllProcess",updateProcessType:"/admin/processDesigner/manager/process/updateProcessType",getProcdefById:"/admin/processDesigner/manager/process/getProcdefById",getAllOrg:"/admin/processDesigner/public/visible/getAllOrg",getAllRole:"/admin/processDesigner/public/visible/getAllRole",getAllUser:"/admin/processDesigner/public/visible/getAllUser",getProcessVisibleOrg:"/admin/processDesigner/manager/visible/getProcessVisibleOrg",getProcessVisibleRole:"/admin/processDesigner/manager/visible/getProcessVisibleRole",getProcessVisiblePerson:"/admin/processDesigner/manager/visible/getProcessVisiblePerson",saveProcessVisibleOrg:"/admin/processDesigner/manager/visible/saveProcessVisibleOrg",saveProcessVisibleRole:"/admin/processDesigner/manager/visible/saveProcessVisibleRole",saveProcessVisibleUser:"/admin/processDesigner/manager/visible/saveProcessVisibleUser",saveProcessForm:"/admin/processDesigner/manager/processForm/save",getAssignTaskList:"/admin/processDesigner/public/process/getAssignTaskList",saveUserTaskDesignator:"/admin/processDesigner/manager/process/saveUserTaskDesignator",getProcdefByKey:"/admin/processDesigner/public/processForm/getProcdefByKey",getProcessImage:"/admin/processDesigner/manager/file/getProcessImage",downloadProcessFile:"/admin/processDesigner/manager/file/downloadProcessFile",updateProcessStatus:"/admin/processDesigner/manager/process/updateProcessStatus",getAllProcessTypeWithDelete:"/admin/processType/procdeftype/findAllDelete/"}};t["a"]=a},ea4b:function(e,t,s){}}]);
//# sourceMappingURL=chunk-03b962cf.cfbe5450.js.map