(window["webpackJsonpmicro_name_"]=window["webpackJsonpmicro_name_"]||[]).push([["chunk-d86c2638"],{"05e5":function(t,e,a){},"20b9":function(t,e,a){"use strict";var n=a("d297"),r=a.n(n);r.a},2873:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a(t.whichComponent,{tag:"component",attrs:{deviceId:t.deviceId,deviceName:t.deviceName},on:{switch:t.switchComponent,"update:deviceId":function(e){t.deviceId=e},"update:device-id":function(e){t.deviceId=e}}})],1)},r=[],i=(a("7f7f"),a("d225")),s=a("b0b4"),o=a("308d"),c=a("6bb5"),u=a("4e2b"),l=a("9ab4"),h=a("60a3"),d=a("b9f5"),p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("el-input",{staticClass:"input",attrs:{size:"small",maxlength:100,placeholder:"设备名称",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)}},model:{value:t.pagination.query.name,callback:function(e){t.$set(t.pagination.query,"name",e)},expression:"pagination.query.name"}}),a("el-cascader",{staticClass:"input",attrs:{size:"small",placeholder:"设备类型",clearable:"",options:t.typeOptions,props:{label:"name",value:"id",checkStrictly:!0}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)}},model:{value:t.typeDetailId,callback:function(e){t.typeDetailId=e},expression:"typeDetailId"}}),a("q-search-button",{on:{click:t.search}})],1),a("el-button",{attrs:{size:"small",icon:"el-icon-download"},on:{click:t.downloadExcel}},[t._v("下载Excel模板")]),a("el-upload",{ref:"upload",staticStyle:{display:"inline-block","margin-left":"20px","margin-right":"20px"},attrs:{action:t.uploadProcessFileUrl,"show-file-list":!1,headers:t.httpHeaders,"on-success":t.uploadFileSuccess,"on-error":t.uploadFileError,multiple:"",limit:1,"file-list":t.uploadFileList}},[a("el-button",{attrs:{size:"small",icon:"el-icon-upload"}},[t._v("批量导入")])],1),a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.switchToDetails("add")}}},[t._v("添加")])],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{"margin-top":"20px"}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","min-height":"calc(100vh - 294px)"},attrs:{data:t.tableData},on:{"selection-change":t.getAllSelected}},[a("el-table-column",{attrs:{align:"center",prop:"id",label:"序号",type:"index",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.$index+(t.pagination.current-1)*t.pagination.size+1)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"code",label:"设备编码","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"name",label:"设备名称","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"orgName",label:"所属组织","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"设备图片",prop:"image","min-width":"","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{staticClass:"img-wrap"},[e.row.image?a("el-image",{staticClass:"img",attrs:{src:e.row.image,fit:"contain"}}):[t._v("\n            暂无图片\n          ")]],2)}}])}),a("el-table-column",{attrs:{prop:"typeDetailName",label:"设备类型","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"status",label:"是否可用","min-width":"","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{domProps:{textContent:t._s(e.row.status?"启用":"未启用")}})]}}])}),a("el-table-column",{attrs:{prop:"bound",label:"是否被绑定","min-width":"","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{domProps:{textContent:t._s(!0===e.row.bound?"绑定":"未绑定")}})]}}])}),a("el-table-column",{attrs:{prop:"status",label:"设备状态","min-width":"","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[!1!==e.row.isNormal?a("span",[t._v("正常")]):a("span",[t._v(t._s(e.row.deviceStatusRelations.map((function(t){return t.statusName})).join("、")))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-view",title:"查看"},on:{click:function(a){return t.switchToDetails("data",e.row)}}},[t._v("查看")]),a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){return t.switchToDetails("edit",e.row)}}},[t._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete",title:"删除"},on:{click:function(a){return t.handleDelete(e.row)}}},[t._v("删除")])]}}])})],1)],1),a("q-pagination",{attrs:{"current-page":t.pagination.current,size:"small","page-size":t.pagination.size,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.pagination,"current",e)},"update:current-page":function(e){return t.$set(t.pagination,"current",e)}}})],1)},m=[],f=(a("ac6a"),a("96cf"),a("3b8d")),v=a("ef0f"),g=a("4791"),y=a("c195"),b=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(o["a"])(this,Object(c["a"])(e).apply(this,arguments)),t.tableData=[],t.loading=!1,t.pagination={current:1,size:10,total:0,query:{name:"",code:"",typedetailId:""}},t.multipleSelection=[],t.typeOptions=[],t.typeDetailId=[],t.uploadProcessFileUrl=v["a"].upload,t.httpHeaders={accessToken:"Bearer "+y["a"].get("accessToken")},t.uploadFileList=[],t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"created",value:function(){this.getList(),this.getTypeOptions()}},{key:"switchToDetails",value:function(){}},{key:"search",value:function(){this.pagination.current=1,this.getList()}},{key:"getList",value:function(){var t=this;this.loading=!0;var e=this.typeDetailId;Array.isArray(e)&&(e.length?this.pagination.query.typedetailId=e[e.length-1]:this.pagination.query.typedetailId=""),this.$http.post(v["a"].getPaging,this.pagination).then((function(e){t.loading=!1,e.data.status?(t.tableData=e.data.data.records,t.pagination.total=e.data.data.total):t.$message.error(e.data.message)})).finally((function(){t.loading=!1}))}},{key:"getTypeOptions",value:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){var e,a,n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.get(v["a"].getDeviceTypeTree);case 2:e=t.sent,a=e.data,n=a.data,r=a.status,i=a.message,r?(this.typeOptions=n,Object(g["a"])(this.typeOptions)):this.$message.error(i);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"handleCurrentChange",value:function(t){this.pagination.current=t,this.getList()}},{key:"handleSizeChange",value:function(t){this.pagination.size=t,this.getList()}},{key:"deleteDevices",value:function(t){var e=this;0!==t.length?this.$confirm("是否删除设备相关数据？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$http.post(v["a"].multipleDelete,t).then((function(t){t.data.status?(e.$message.success("操作成功"),e.getList()):e.$message.error(t.data.message)}))})):this.$message.warning("请选择要删除的数据！")}},{key:"handleDelete",value:function(t){var e=[];e.push(t.id),this.deleteDevices(e)}},{key:"multipleDelete",value:function(){var t=[];this.multipleSelection.forEach((function(e){t.push(e.id)})),this.deleteDevices(t)}},{key:"getAllSelected",value:function(t){this.multipleSelection=t}},{key:"handleSeeNotNormal",value:function(){}},{key:"downloadExcel",value:function(){var t=document.createElement("a");t.href=v["a"].download,t.click()}},{key:"uploadFileSuccess",value:function(t,e){t.status?(this.$message.success(t.message),this.getList()):(this.$message.error(t.message),this.getList())}},{key:"uploadFileError",value:function(){this.$message.error("操作失败！")}}]),e}(h["e"]);l["__decorate"]([Object(h["b"])("switch")],b.prototype,"switchToDetails",null),b=l["__decorate"]([Object(h["a"])({})],b);var D=b,w=D,x=(a("9e9a"),a("2877")),k=Object(x["a"])(w,p,m,!1,null,"d2ecf58c",null),O=k.exports,C=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[t._v("\n      "+t._s(t.deviceName)+"\n      ")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.$emit("switch")}}},[t._v("返回")])],1),a("el-table",{staticStyle:{"margin-top":"16px"},attrs:{data:t.currentTableData}},[a("el-table-column",{attrs:{align:"center",prop:"id",label:"序号",type:"index",width:"100"}}),a("el-table-column",{attrs:{prop:"time",label:"时间","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("timeFilter")(e.row.time)))])]}}])}),a("el-table-column",{attrs:{prop:"sensorName",label:"传感器名称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"name",label:"检测项目","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"value",label:"数据","show-overflow-tooltip":"",formatter:function(t){return t.value+" "+(t.unit||"")}}})],1),a("div",{staticClass:"header",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"left"},[t._v("\n      历史数据\n      "),a("el-select",{staticStyle:{"margin-left":"8px"},attrs:{size:"small"},on:{change:t.getSensorData},model:{value:t.dateType,callback:function(e){t.dateType=e},expression:"dateType"}},[a("el-option",{attrs:{label:"过去两小时",value:"two"}}),a("el-option",{attrs:{label:"过去四小时",value:"four"}}),a("el-option",{attrs:{label:"过去六小时",value:"six"}}),a("el-option",{attrs:{label:"过去八小时",value:"eight"}}),a("el-option",{attrs:{label:"过去十小时",value:"ten"}}),a("el-option",{attrs:{label:"过去十二小时",value:"twelve"}}),a("el-option",{attrs:{label:"过去十四小时",value:"fourteen"}}),a("el-option",{attrs:{label:"过去十六小时",value:"sixteen"}}),a("el-option",{attrs:{label:"过去十八小时",value:"eighteen"}}),a("el-option",{attrs:{label:"过去二十小时",value:"twenty"}}),a("el-option",{attrs:{label:"过去二十二小时",value:"twenty_two"}}),a("el-option",{attrs:{label:"过去二十四小时",value:"twenty_four"}})],1)],1)]),a("div",{ref:"chart",staticClass:"chart"})],1)},_=[],j=(a("8e6e"),a("456d"),a("bd86")),S=a("c1df"),T=a.n(S),L=a("313e"),N=a.n(L);function $(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function I(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?$(Object(a),!0).forEach((function(e){Object(j["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):$(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var E=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(o["a"])(this,Object(c["a"])(e).apply(this,arguments)),t.sensorList=[],t.sensorCheckedList=[],t.dateType="two",t.currentTableData=[],t.chartData=[],t.data=[],t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"handleDataTypeChange",value:function(){this.echarts&&this.echarts.clear()}},{key:"mounted",value:function(){this.echarts=N.a.init(this.$refs.chart),this.getSensorList(),this.getSensorData()}},{key:"destroyed",value:function(){clearTimeout(this.timer),clearTimeout(this.newTimer)}},{key:"getSensorList",value:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){var e,a,n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.get(v["a"].getBindSensor+this.deviceId);case 2:e=t.sent,a=e.data,n=a.status,r=a.data,i=a.message,n&&r.length?(this.sensorList=r,this.sensorCheckedList=r.map((function(t){return t.name}))):this.$message.error(i);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"handleChange",value:function(){this.currentData.length&&(this.chartData=this.currentData.map((function(t){return{dataList:t.chartData.dataList.map((function(e){return I({},e,{sensorName:t.sensorName})})),xaxisData:t.chartData.xaxisData}})),this.renderChart(this.chartData),this.currentTableData=this.currentData.map((function(t){return t.currentData.map((function(e){return I({},e,{sensorName:t.sensorName})}))})).reduce((function(t,e){return t.concat(e)})))}},{key:"getSensorData",value:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){var e,a,n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.echarts&&this.echarts.clear(),clearTimeout(this.timer),t.prev=2,t.next=5,this.$http.get(v["a"].sensorHistory+this.deviceId+"/"+this.dateType);case 5:e=t.sent,a=e.data,n=a.status,r=a.data,i=a.message,n?r?(r=r.filter((function(t){return t})),this.data=r,r.length?this.getCurrentData():this.newTimer&&clearTimeout(this.newTimer)):this.$message.info("暂无数据"):this.$message.error(i);case 11:return t.prev=11,this.newTimer&&clearTimeout(this.timer),t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[2,,11,14]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"getCurrentData",value:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){var e,a,n,r,i,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return clearTimeout(this.timer),clearTimeout(this.newTimer),t.prev=2,t.next=5,this.$http.get(v["a"].getCurrentData+this.deviceId);case 5:e=t.sent,a=e.data,n=a.status,r=a.data,i=a.message,n?(r.forEach((function(t){s.data.forEach((function(e){t.sensorId===e.sensorId&&e.chartData.xaxisData[e.chartData.xaxisData.length-1]!==t.currentData[0].time&&(e.chartData.dataList.forEach((function(e){t.currentData.forEach((function(t){t.code===e.code&&(e.data.shift(),e.data.push(t.value))}))})),e.chartData.xaxisData.shift(),e.chartData.xaxisData.push(t.currentData[0].time),e.currentData=t.currentData)}))})),this.handleChange()):this.$message.error(i);case 11:return t.prev=11,this._isDestroyed||(this.newTimer=setTimeout((function(){s.getCurrentData()}),5e3)),t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[2,,11,14]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"renderChart",value:function(t){this.echarts.setOption({tooltip:{trigger:"axis",formatter:function(t){var e={};t.forEach((function(t){e[t.name]?e[t.name].push("".concat(t.marker," ").concat(t.seriesName,"： ").concat(t.data.value," ").concat(t.data.unit?t.data.unit:"")):e[t.name]=["".concat(t.marker," ").concat(t.seriesName,"： ").concat(t.data.value," ").concat(t.data.unit?t.data.unit:"")]}));var a="";for(var n in e)a+="".concat(n,"<br/>").concat(e[n].reduce((function(t,e){return t+"<br/>"+e})),"<br/>");return a}},legend:{data:t.map((function(t){return t.dataList.map((function(t){return"".concat(t.sensorName,"：").concat(t.name)}))})).reduce((function(t,e){return t.concat(e)}))},grid:{left:10,right:10,top:20,bottom:0},xAxis:t.map((function(t){return{type:"category",boundaryGap:!1,data:t.xaxisData.map((function(t){return T()(t).format("HH:mm:ss")})),show:!1}})),yAxis:t.map((function(t){return t.dataList.map((function(){return{type:"value",show:!1}}))})).reduce((function(t,e){return t.concat(e)})),series:t.map((function(t,e){return t.dataList.forEach((function(t){t.xAxisIndex=e})),t.dataList})).reduce((function(t,e){return t.concat(e)})).map((function(t,e){return{xAxisIndex:t.xAxisIndex,yAxisIndex:e,name:"".concat(t.sensorName,"：").concat(t.name),type:"line",data:t.data.map((function(e){return{value:e,unit:t.unit}}))}}))})}},{key:"currentData",get:function(){return this.data}}]),e}(h["e"]);l["__decorate"]([Object(h["d"])({type:String,required:!0})],E.prototype,"deviceId",void 0),l["__decorate"]([Object(h["d"])({type:String,required:!0})],E.prototype,"deviceName",void 0),l["__decorate"]([Object(h["f"])("dataType",{immediate:!0})],E.prototype,"handleDataTypeChange",null),l["__decorate"]([Object(h["f"])("currentData")],E.prototype,"handleChange",null),E=l["__decorate"]([Object(h["a"])({filters:{timeFilter:function(t){if(t)return T()(t).format("YYYY-MM-DD HH:mm:ss")}}})],E);var z=E,H=z,q=(a("7078"),Object(x["a"])(H,C,_,!1,null,"9844de80",null)),P=q.exports,A=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[t._v("\n      设备名称："),a("span",[t._v(t._s(t.deviceName))])]),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.$emit("switch")}}},[t._v("返回")])],1),a("div",{staticClass:"title"},[a("div",{staticClass:"label"},[t._v("传感器最新数据")]),a("el-checkbox-group",{staticStyle:{"margin-left":"30px"},attrs:{disabled:1===t.sensorList.length},model:{value:t.sensorCheckedList,callback:function(e){t.sensorCheckedList=e},expression:"sensorCheckedList"}},t._l(t.sensorList,(function(e,n){return a("el-checkbox",{key:n,attrs:{label:e.name}},[t._v(t._s(e.name))])})),1)],1),a("el-table",{staticStyle:{"margin-top":"10px"},attrs:{data:t.currentTableData}},[a("el-table-column",{attrs:{align:"center",prop:"id",label:"序号",type:"index",width:"100"}}),a("el-table-column",{attrs:{prop:"time",label:"时间","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("timeFilter")(e.row.time)))])]}}])}),a("el-table-column",{attrs:{prop:"sensorName",label:"传感器名称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"name",label:"检测项目","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"value",label:"数据","show-overflow-tooltip":"",formatter:function(t){return t.value+" "+(t.unit||"")}}})],1),a("div",{staticClass:"title"},[t._v("历史数据趋势")]),a("div",{staticClass:"chart-control"},[a("span",[t._v("按时段查看：")]),a("el-select",{attrs:{size:"small",clearable:!1},model:{value:t.dateType,callback:function(e){t.dateType=e},expression:"dateType"}},[a("el-option",{attrs:{label:"过去十五分钟",value:"quarter"}}),a("el-option",{attrs:{label:"过去三十分钟",value:"half"}}),a("el-option",{attrs:{label:"过去四十五分钟",value:"threeQuarters"}}),a("el-option",{attrs:{label:"过去一小时",value:"hour"}}),a("el-option",{attrs:{label:"过去一个半小时",value:"halfAndHour"}}),a("el-option",{attrs:{label:"过去两小时",value:"twoHours"}})],1),a("q-search-button",{staticStyle:{margin:"0 20px 0 10px"},attrs:{size:"small",type:"primary"},on:{click:t.getHistoryData}}),a("span",[t._v("自定义时间段：")]),a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至",size:"small","value-format":"yyyy-MM-dd HH:mm:ss","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!1},model:{value:t.timeQuantum,callback:function(e){t.timeQuantum=e},expression:"timeQuantum"}}),a("q-search-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"primary"},on:{click:t.getTimeQuantumData}})],1),a("div",{ref:"chart",staticClass:"chart"})],1)},R=[];function Q(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function F(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?Q(Object(a),!0).forEach((function(e){Object(j["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Q(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var M=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(o["a"])(this,Object(c["a"])(e).apply(this,arguments)),t.presentData=[],t.data=[],t.lineChart=null,t.sensorList=[],t.sensorCheckedList=[],t.dateType="",t.timeQuantum=[],t.timer=null,t.timerStatus="init",t.renderSensorNum=0,t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"handleChange",value:function(){this.renderChart(this.chartData)}},{key:"created",value:function(){this.getSensorList(),this.getCurrentData()}},{key:"mounted",value:function(){this.lineChart=N.a.init(this.$refs["chart"])}},{key:"destroyed",value:function(){this.lineChart.dispose(),clearTimeout(this.timer)}},{key:"getSensorList",value:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){var e,a,n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$http.get(v["a"].getBindSensor+this.deviceId);case 2:e=t.sent,a=e.data,n=a.status,r=a.data,i=a.message,n&&r.length?(this.sensorList=r,this.sensorCheckedList=r.map((function(t){return t.name}))):this.$message.error(i);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getHistoryData",value:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){var e,a,n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.dateType&&""!==this.dateType){t.next=3;break}return this.$message.error("时间段不能为空"),t.abrupt("return");case 3:return this.timerStatus="queryHistoryData",this.lineChart&&this.lineChart.clear(),this.timeQuantum=[],t.prev=6,t.next=9,this.$http.get(v["a"].sensorHistory+this.deviceId+"/"+this.dateType);case 9:e=t.sent,a=e.data,n=a.status,r=a.data,i=a.message,n?(this.data=r,this.timerStatus="queryCurrentData"):this.$message.error(i);case 15:return t.prev=15,t.finish(15);case 17:case"end":return t.stop()}}),t,this,[[6,,15,17]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"getCurrentData",value:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){var e,a,n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$http.get(v["a"].getCurrentData+this.deviceId);case 3:e=t.sent,a=e.data,n=a.status,r=a.data,i=a.message,n?(this.presentData=r,"queryCurrentData"===this.timerStatus&&this.mergeCurrentData(r)):this.$message.error(i);case 9:return t.prev=9,this.timerScheduler(),t.finish(9);case 12:case"end":return t.stop()}}),t,this,[[0,,9,12]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"mergeCurrentData",value:function(t){var e=this,a=(new Date).valueOf(),n=2;switch(this.dateType){case"quarter":n=.25;break;case"half":n=.5;break;case"threeQuarters":n=.75;break;case"hour":n=1;break;case"halfAndHour":n=1.5;break;default:n=2}var r={};if(this.data.forEach((function(t){r[t.sensorId]=t})),t.some((function(t){return!r[t.sensorId]&&a-new Date(t.currentData[0].time).valueOf()<36e5*n})))this.getHistoryData();else{var i={};t.forEach((function(t){i[t.sensorId]=t})),this.data.forEach((function(t){var r={};t.chartData.dataList.forEach((function(t){r[t.code]=t}));var s=i[t.sensorId];if(s.currentData.some((function(t){return!r[t.code]})))e.getHistoryData();else{var o={};s.currentData.forEach((function(t){o[t.code]=t}));var c=s.currentData[0].time;t.chartData&&t.chartData.xaxisData[t.chartData.xaxisData.length-1]!==c&&(t.chartData.dataList.forEach((function(t){var e=o[t.code];void 0===e?t.data.push(""):t.data.push(e.value)})),t.chartData.xaxisData.push(c),t.currentData=s.currentData),a-new Date(t.chartData.xaxisData[0]).valueOf()>36e5*n&&(t.chartData.xaxisData.shift(),t.chartData.dataList.forEach((function(t){t.data.shift()})))}}))}}},{key:"getTimeQuantumData",value:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){var e,a,n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.timeQuantum.length&&this.timeQuantum!==[]){t.next=3;break}return this.$message.error("时间段不能为空"),t.abrupt("return");case 3:return this.timerStatus="queryTimeQuantumData",this.dateType="",this.lineChart&&this.lineChart.clear(),t.prev=6,t.next=9,this.$http.post("".concat(v["a"].getTimeQuantumData,"/").concat(this.deviceId),{startTime:this.timeQuantum[0],endTime:this.timeQuantum[1]});case 9:e=t.sent,a=e.data,n=a.status,r=a.data,i=a.message,n?this.data=r:this.$message.error(i),t.next=20;break;case 17:t.prev=17,t.t0=t["catch"](6),this.$message.error("查询失败");case 20:case"end":return t.stop()}}),t,this,[[6,17]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"timerScheduler",value:function(){var t=this;this._isDestroyed||(this.timer=setTimeout((function(){if(!t._isDestroyed)switch(t.timerStatus){case"init":case"queryTimeQuantumData":case"queryCurrentData":t.getCurrentData();break;case"queryHistoryData":t.getHistoryData(),t.getCurrentData();break}}),1e4))}},{key:"renderChart",value:function(t){this.renderSensorNum&&t.length!==this.renderSensorNum&&this.lineChart.clear(),this.renderSensorNum=t.length,t.length&&this.lineChart.setOption({tooltip:{trigger:"axis",formatter:function(t){var e={};t.forEach((function(t){e[t.name]?t.data.value&&e[t.name].push("".concat(t.marker," ").concat(t.seriesName,"： ").concat(t.data.value," ").concat(t.data.unit?t.data.unit:"")):e[t.name]=["".concat(t.marker," ").concat(t.seriesName,"： ").concat(t.data.value," ").concat(t.data.unit?t.data.unit:"")]}));var a="";for(var n in e)a+="".concat(n,"<br/>").concat(e[n].reduce((function(t,e){return t+"<br/>"+e})),"<br/>");return a}},legend:{data:t.map((function(t){return t.dataList.map((function(t){return"".concat(t.sensorName,"：").concat(t.name)}))})).reduce((function(t,e){return t.concat(e)}))},grid:{left:50,right:50,top:50,bottom:30},xAxis:t.map((function(t){return{type:"category",boundaryGap:!1,data:t.xaxisData.map((function(t){return T()(t).format("HH:mm:ss")})),show:!1}})),yAxis:t.map((function(t){return t.dataList.map((function(){return{type:"value",show:!1}}))})).reduce((function(t,e){return t.concat(e)})),series:t.map((function(t,e){return t.dataList.forEach((function(t){t.xAxisIndex=e})),t.dataList})).reduce((function(t,e){return t.concat(e)})).map((function(t,e){return{xAxisIndex:t.xAxisIndex,yAxisIndex:e,name:"".concat(t.sensorName,"：").concat(t.name),type:"line",data:t.data.map((function(e){return{value:e,unit:t.unit}}))}}))})}},{key:"sensorCheckedNameMap",get:function(){var t={};return this.sensorCheckedList.forEach((function(e){t[e]=!0})),t}},{key:"chartData",get:function(){var t=this;return this.data.filter((function(e){return t.sensorCheckedNameMap[e.sensorName]})).map((function(t){return t.chartData?{dataList:t.chartData.dataList.map((function(e){return F({},e,{sensorName:t.sensorName})})),xaxisData:t.chartData.xaxisData,sensorName:t.sensorName}:{dataList:[],xaxisData:[],sensorName:""}}))}},{key:"currentTableData",get:function(){var t=this,e=[];return this.sensorCheckedList.length&&this.presentData.length&&(e=this.presentData.map((function(t){return t.currentData.map((function(e){return F({},e,{sensorName:t.sensorName})}))})).reduce((function(t,e){return t.concat(e)})).filter((function(e){return t.sensorCheckedNameMap[e.sensorName]}))),e}}]),e}(h["e"]);l["__decorate"]([Object(h["d"])({type:String,required:!0})],M.prototype,"deviceId",void 0),l["__decorate"]([Object(h["d"])({type:String,required:!0})],M.prototype,"deviceName",void 0),l["__decorate"]([Object(h["f"])("chartData")],M.prototype,"handleChange",null),M=l["__decorate"]([Object(h["a"])({filters:{timeFilter:function(t){if(t)return T()(t).format("YYYY-MM-DD HH:mm:ss")}}})],M);var Y=M,B=Y,G=(a("20b9"),Object(x["a"])(B,A,R,!1,null,"4d43984c",null)),J=G.exports,U=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(o["a"])(this,Object(c["a"])(e).apply(this,arguments)),t.whichComponent="DeviceList",t.deviceId="",t.deviceName="",t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"switchComponent",value:function(t,e){switch(t){case"add":this.whichComponent="DeviceDetail",this.deviceId="";break;case"edit":this.whichComponent="DeviceDetail",this.deviceId=e.id;break;case"data":this.whichComponent="DeviceDataChart",this.deviceId=e.id,this.deviceName=e.name;break;default:this.whichComponent="DeviceList"}}}]),e}(h["e"]);U=l["__decorate"]([Object(h["a"])({components:{DeviceDetail:d["a"],DeviceList:O,DeviceDataChart:J,DeviceData:P}})],U);var K=U,V=K,W=Object(x["a"])(V,n,r,!1,null,"60dc1632",null);e["default"]=W.exports},4791:function(t,e,a){"use strict";a("ac6a");function n(t){t.forEach((function(t){t.children&&t.children.length?n(t.children):delete t.children}))}e["a"]=n},7078:function(t,e,a){"use strict";var n=a("fdc0"),r=a.n(n);r.a},"9e9a":function(t,e,a){"use strict";var n=a("05e5"),r=a.n(n);r.a},d297:function(t,e,a){},fdc0:function(t,e,a){}}]);
//# sourceMappingURL=chunk-d86c2638.6ec117c5.js.map