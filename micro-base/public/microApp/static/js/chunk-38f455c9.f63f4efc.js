(window["webpackJsonpmicro_name_"]=window["webpackJsonpmicro_name_"]||[]).push([["chunk-38f455c9"],{"096f":function(e,t,a){"use strict";var n={getPaging:"/admin/person/pagingPerson",add:"/admin/person/add",update:"/admin/person/update",delete:"/admin/person/delete",multipleDelete:"/admin/person/multipleDelete",findByMobile:"/admin/person/findByMobile",getPersonInfoById:"/admin/person/getPersonById",getPersonDevice:"/admin/personDevice/listDeviceByPersonId/personId/",cancelPersonDevice:"/admin/personDevice/unbind",bindPersonDevice:"/admin/personDevice/bind/personId/",updateGps:"/admin/personDevice/updateGPSMark/personDeviceId/",getTypeDetail:"/admin/typeDetail",findTypeTree:"/admin/typeDetail/findTypeTree",getTemplateByTypeDetaiId:"/admin/typeDetail/getTemplateByTypeDetaiId",deleteType:"/admin/typeDetail/delete",saveCustomAttrItems:"/admin/typeDetail/saveCustomAttrItems",getOrgTreeData:"/admin/organization/orgTree",getNewTypeTree:"/admin/organization/orgTree/person",roleList:"/admin/role/list",getDevicePaging:"/admin/device/pagingDevice",download:"/api/excel/download/personTemplate",upload:"/api/excel/upload/personTemplate"};t["a"]=n},"19dd":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a(e.whichComponent,{tag:"component",attrs:{listRowId:e.listRowId},on:{switch:e.switchComponent,"update:listRowId":function(t){e.listRowId=t},"update:list-row-id":function(t){e.listRowId=t}}})],1)},i=[],s=a("d225"),o=a("b0b4"),r=a("308d"),l=a("6bb5"),c=a("4e2b"),u=a("9ab4"),p=a("60a3"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("el-input",{staticClass:"input",attrs:{size:"small",maxlength:100,placeholder:"姓名",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.pagination.query.name,callback:function(t){e.$set(e.pagination.query,"name",t)},expression:"pagination.query.name"}}),a("el-cascader",{staticClass:"input",attrs:{size:"small",options:e.orgOptions,clearable:"",props:e.typeDetailProps},model:{value:e.filterOrgId,callback:function(t){e.filterOrgId=t},expression:"filterOrgId"}}),a("q-search-button",{on:{click:e.search}})],1),a("el-button",{attrs:{size:"small",icon:"el-icon-download"},on:{click:e.downloadExcel}},[e._v("下载Excel模板")]),a("el-upload",{ref:"upload",staticStyle:{display:"inline-block","margin-left":"20px","margin-right":"20px"},attrs:{action:e.uploadProcessFileUrl,"show-file-list":!1,headers:e.httpHeaders,"on-success":e.uploadFileSuccess,"on-error":e.uploadFileError,multiple:"",accept:".xls","before-upload":e.beforeUpload,limit:1,"file-list":e.uploadFileList}},[a("el-button",{attrs:{size:"small",icon:"el-icon-upload"}},[e._v("批量导入")])],1),a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.switchToDetails("add")}}},[e._v("添加")])],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"margin-top":"20px"}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","min-height":"calc(100vh - 300px)"},attrs:{data:e.tableData},on:{"selection-change":e.getAllSelected}},[a("el-table-column",{attrs:{align:"center",prop:"id",label:"序号",type:"index",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.$index+(e.pagination.current-1)*e.pagination.size+1)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"realName",label:"姓名","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"mobile",label:"手机","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"username",label:"登录名","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"typeName",label:"人员类型","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.switchToDetails("edit",t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1),a("q-pagination",{attrs:{"current-page":e.pagination.current,size:"small","page-size":e.pagination.size,"page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.pagination,"current",t)},"update:current-page":function(t){return e.$set(e.pagination,"current",t)}}})],1)},m=[],g=(a("7f7f"),a("ac6a"),a("73ec")),h=a("096f"),f=(a("6b54"),a("96cf"),a("3b8d")),v={xls:"application/vnd.ms-excel;charset=utf-8",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"};function b(e){return new Promise((function(t){var a=new FileReader;a.onload=function(e){return t(e.target.result)},a.readAsText(new Blob([e]),"UTF-8")}))}function y(e){return w.apply(this,arguments)}function w(){return w=Object(f["a"])(regeneratorRuntime.mark((function e(t){var a,n,i,s,o=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=o.length>1&&void 0!==o[1]?o[1]:"下载",n=o.length>2&&void 0!==o[2]?o[2]:"xls",i={},!(t.byteLength<4096)){e.next=17;break}return e.prev=4,e.t0=JSON,e.next=8,b(t).toString();case 8:e.t1=e.sent,i=e.t0.parse.call(e.t0,e.t1),e.next=15;break;case 12:e.prev=12,e.t2=e["catch"](4),console.log(e.t2);case 15:if(!("message"in i)){e.next=17;break}throw new Error(i.message);case 17:s=document.createElement("a"),s.href=(window.URL||window.webkitURL).createObjectURL(new Blob([t],{type:v[n]})),s.download=a+"."+n,s.dispatchEvent(new MouseEvent("click"));case 21:case"end":return e.stop()}}),e,null,[[4,12]])}))),w.apply(this,arguments)}var D=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(r["a"])(this,Object(l["a"])(t).apply(this,arguments)),e.tableData=[],e.loading=!1,e.pagination={current:1,size:10,total:0,query:{name:"",organizationId:""}},e.multipleSelection=[],e.orgOptions=[],e.filterOrgId="",e.typeDetailProps={label:"name",value:"id",checkStrictly:!0},e}return Object(c["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.getList(),this.getOrgInfo()}},{key:"switchToDetails",value:function(){}},{key:"WatchFilterOrg",value:function(e,t){this.pagination.query.organizationId=g["a"].lastOfArr(this.filterOrgId)}},{key:"getOrgInfo",value:function(){var e=this;this.$http.get(h["a"].getNewTypeTree).then((function(t){t.status&&(t.data.status?(e.orgOptions=t.data.data,g["a"].removeEmptyChildren(e.orgOptions)):e.$message.error(t.data.message))}))}},{key:"search",value:function(){this.pagination.current=1,this.getList()}},{key:"getList",value:function(){var e=this;this.loading=!0,this.$http.post(h["a"].getPaging,this.pagination).then((function(t){e.loading=!1,t.status&&(t.data.status?(e.tableData=t.data.data.records,e.pagination.total=t.data.data.total):e.$message.error(t.data.message))})).catch((function(){e.loading=!1}))}},{key:"handleCurrentChange",value:function(e){this.pagination.current=e,this.getList()}},{key:"handleSizeChange",value:function(e){this.pagination.size=e,this.getList()}},{key:"deletePersons",value:function(e){var t=this,a=this;0!==e.length?a.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$http.post(h["a"].multipleDelete,e).then((function(e){e.data.status?(a.$message.success(e.data.message),a.getList()):a.$message.error(e.data.message)}))})).catch((function(){})):a.$message.warning("请选择要删除的数据！")}},{key:"handleDelete",value:function(e){var t=[];t.push(e.id),this.deletePersons(t)}},{key:"multipleDelete",value:function(){var e=[];this.multipleSelection.forEach((function(t){e.push(t.id)})),this.deletePersons(e)}},{key:"getAllSelected",value:function(e){this.multipleSelection=e}},{key:"downloadExcel",value:function(){var e=this;this.$http.get(h["a"].download,{responseType:"arraybuffer"}).then((function(t){try{y(t.data,"导入人员模板")}catch(n){var a=n.message;e.$message.error(a)}})).catch((function(){}))}},{key:"beforeUpload",value:function(e){var t="xls"===e.name.substring(e.name.lastIndexOf(".")+1);return t||this.$message({message:"上传文件只能是 xls 格式!",type:"warning"}),t}},{key:"uploadFileSuccess",value:function(e,t){e.status?(this.$message.success(e.message),this.getList()):(this.$message.error(e.message),this.getList())}},{key:"uploadFileError",value:function(){this.$message.error("操作失败！")}}]),t}(p["e"]);u["__decorate"]([Object(p["b"])("switch")],D.prototype,"switchToDetails",null),u["__decorate"]([Object(p["f"])("filterOrgId")],D.prototype,"WatchFilterOrg",null),D=u["__decorate"]([Object(p["a"])({})],D);var k=D,x=k,O=(a("46ee"),a("2877")),I=Object(O["a"])(x,d,m,!1,null,"f66b9924",null),F=I.exports,$=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("el-button",{staticClass:"back",attrs:{size:"small"},on:{click:e.switchToPersonList}},[e._v("返回")]),a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"card"}},[a("el-tab-pane",{staticClass:"content",attrs:{label:"基本信息"}},[a("div",[a("el-form",{ref:"personDetailsForm",staticStyle:{"margin-top":"20px"},attrs:{size:"small","label-width":"150px",model:e.personDetailsForm,rules:e.personDetailsFormRules}},[a("el-row",{attrs:{gutter:0}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"姓名：",prop:"realName"}},[a("el-input",{attrs:{maxlength:100,placeholder:"请输入",disabled:e.disabled},model:{value:e.personDetailsForm.realName,callback:function(t){e.$set(e.personDetailsForm,"realName",t)},expression:"personDetailsForm.realName"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"手机号：",prop:"mobile"}},[a("el-input",{attrs:{type:"tel",placeholder:"请输入"},model:{value:e.personDetailsForm.mobile,callback:function(t){e.$set(e.personDetailsForm,"mobile",t)},expression:"personDetailsForm.mobile"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"人员类型：",prop:"typeDetailId"}},[a("q-tree",{attrs:{"tree-data":e.personTypeOptions,"tree-prop":{value:"id",label:"name"},title:"人员类型",multi:!1,"need-stringify":!0,closable:!1},on:{qClick:e.savePersonType},model:{value:e.personDetailsForm.typeDetailId,callback:function(t){e.$set(e.personDetailsForm,"typeDetailId",t)},expression:"personDetailsForm.typeDetailId"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"角色：",prop:"roleIds"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择",disabled:e.disabled},model:{value:e.personDetailsForm.roleIds,callback:function(t){e.$set(e.personDetailsForm,"roleIds",t)},expression:"personDetailsForm.roleIds"}},e._l(e.roleOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"所属组织：",prop:"organizationIds"}},[a("q-tree",{attrs:{"tree-data":e.orgOptions,"tree-prop":{value:"id",label:"name"},title:"所属组织",multi:!0,"need-stringify":!1,closable:!0},on:{qClick:e.saveOrg},model:{value:e.personDetailsForm.organizationIds,callback:function(t){e.$set(e.personDetailsForm,"organizationIds",t)},expression:"personDetailsForm.organizationIds"}})],1)],1),a("el-col",{staticStyle:{height:"51px"},attrs:{span:8}},[a("el-form-item",{attrs:{label:"性别：",prop:"gender"}},[a("el-radio-group",{model:{value:e.personDetailsForm.gender,callback:function(t){e.$set(e.personDetailsForm,"gender",t)},expression:"personDetailsForm.gender"}},[a("el-radio-button",{attrs:{label:"男"}}),a("el-radio-button",{attrs:{label:"女"}}),a("el-radio-button",{attrs:{label:"保密"}})],1)],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"出生年月：",prop:"birthDay"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",clearable:"",placeholder:"选择日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd",disabled:e.disabled},model:{value:e.personDetailsForm.birthDay,callback:function(t){e.$set(e.personDetailsForm,"birthDay",t)},expression:"personDetailsForm.birthDay"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"邮箱：",prop:"email"}},[a("el-input",{attrs:{type:"email",placeholder:"请输入",disabled:e.disabled},model:{value:e.personDetailsForm.email,callback:function(t){e.$set(e.personDetailsForm,"email",t)},expression:"personDetailsForm.email"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"电话：",prop:"telPhone"}},[a("el-input",{attrs:{type:"tel",placeholder:"请输入",disabled:e.disabled},model:{value:e.personDetailsForm.telPhone,callback:function(t){e.$set(e.personDetailsForm,"telPhone",t)},expression:"personDetailsForm.telPhone"}})],1)],1)],1),a("el-row",[a("el-form-item",{attrs:{label:"上传图片："}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.personDetailsForm.photo,expression:"personDetailsForm.photo"}],staticClass:"upload-img"},[a("img",{attrs:{src:e.personDetailsForm.photo,alt:""}}),a("div",{staticClass:"mask",on:{click:e.handleRemove}},[a("i",{staticClass:"el-icon-delete"})])]),a("el-upload",{directives:[{name:"show",rawName:"v-show",value:!e.personDetailsForm.photo,expression:"!personDetailsForm.photo"}],ref:"upload",attrs:{action:"/api/file/upload","list-type":"picture-card","http-request":e.customHttpRequest,"on-change":e.customChange,accept:"image/jpeg,image/png,image/jpg",disabled:e.disabled,"auto-upload":!1,multiple:!1,"show-file-list":!1,limit:1}},[a("i",{staticClass:"el-icon-plus"})])],1)],1)],1),e.hasCustomRole?[a("div",[a("el-button",{attrs:{type:"text",disabled:""}},[e._v("\n              自定义属性\n            ")])],1),a("q-custom-input",{ref:"custom-input",attrs:{customOptions:e.customOptions}})]:e._e(),a("div",{staticClass:"block"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],attrs:{type:"primary",size:"small"},on:{click:e.savePerson}},[e._v("保存 ")])],1)],2)]),e.listRowId?a("el-tab-pane",{staticClass:"content",attrs:{label:"设备绑定"}},[a("person-device",{staticStyle:{"margin-top":"20px"},attrs:{personId:e.listRowId}})],1):e._e()],1),a("el-dialog",{attrs:{title:"传感器",visible:e.sensorDialogVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.sensorDialogVisible=t}}},[a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.sensorDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("确 定")])],1)])],1)},P=[],T=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"person-wrapper"},[a("q-title-bar",{attrs:{barTitle:"设备绑定",btnName:"添加设备"},on:{click:e.bindDevice}}),a("el-table",{staticStyle:{width:"100%","margin-top":"20px","min-height":"calc(100vh - 330px)"},attrs:{data:e.deviceList}},[a("el-table-column",{attrs:{align:"center",prop:"id",label:"序号",type:"index",width:"100"}}),a("el-table-column",{attrs:{prop:"code",label:"设备编码","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"name",label:"设备名称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"typeDetailName",label:"设备类型"}}),a("el-table-column",{attrs:{label:"图片详情"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.image?a("el-image",{staticStyle:{height:"40px",width:"60px","margin-top":"6px"},attrs:{src:t.row.image}}):[e._v("\n          暂无图片\n        ")]]}}])}),a("el-table-column",{attrs:{label:"是否有效"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{domProps:{textContent:e._s(!0===t.row.status?"有效":"无效")}})]}}])}),a("el-table-column",{attrs:{label:"GPS设备"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-text":"是","inactive-text":"否","active-value":!0,"inactive-value":!1},on:{change:function(a){return e.changeBindGps(t.row)}},model:{value:t.row.gpsMark,callback:function(a){e.$set(t.row,"gpsMark",a)},expression:"scope.row.gpsMark"}})]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.cancelBind(t.row.id)}}},[e._v("取消绑定")])]}}])})],1),a("el-dialog",{staticStyle:{"min-height":"600px"},attrs:{title:"未绑定的设备列表",visible:e.noBindDeviceDialogVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.noBindDeviceDialogVisible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.addLoading,expression:"addLoading"}]},[a("el-input",{staticStyle:{width:"240px","margin-right":"10px"},attrs:{size:"small",maxlength:100,placeholder:"输入需要查询的设备名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getNoBindList(t)}},model:{value:e.pageParam2.query.name,callback:function(t){e.$set(e.pageParam2.query,"name",t)},expression:"pageParam2.query.name"}}),a("q-search-button",{on:{click:e.getNoBindList}}),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"20px","min-height":"400px"},attrs:{data:e.noBindDeviceList},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",prop:"id",label:"序号",type:"index",width:"100"}}),a("el-table-column",{attrs:{align:"center",prop:"code",label:"设备编码","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",prop:"name",label:"设备名称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",prop:"typeDetailName",label:"设备类型"}}),a("el-table-column",{attrs:{align:"center",label:"图片详情"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.image?a("el-image",{staticStyle:{height:"40px",width:"60px","margin-top":"6px"},attrs:{src:t.row.image}}):[e._v("\n              暂无图片\n            ")]]}}])})],1),a("div",{staticStyle:{width:"100%"}},[a("q-pagination",{attrs:{"current-page":e.pageParam2.current,"page-sizes":[8,10,20,30],"page-size":e.pageParam2.size,layout:"total, sizes, prev, pager, next, jumper",total:e.pageParam2.total},on:{"size-change":e.handleSizeChange2,"current-change":e.handleCurrentChange2}})],1),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.noBindDeviceDialogVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.saveBind}},[e._v("确定")])],1)],1)])],1)},S=[],_=a("ee8b"),C=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(r["a"])(this,Object(l["a"])(t).apply(this,arguments)),e.deviceList=[],e.noBindDeviceList=[],e.noBindDeviceDialogVisible=!1,e.selectedSensor=[],e.pageParam2={size:8,current:1,total:0,query:{name:""}},e.addLoading=!1,e}return Object(c["a"])(t,e),Object(o["a"])(t,[{key:"handleSizeChange2",value:function(e){this.pageParam2.size=e,this.getNoBindList()}},{key:"handleCurrentChange2",value:function(e){this.pageParam2.current=e,this.getNoBindList()}},{key:"handleSelectionChange",value:function(e){this.selectedSensor=e}},{key:"getNoBindList",value:function(){var e=this;this.pageParam2.query.bound=!1,this.$http.post(h["a"].getDevicePaging,this.pageParam2).then((function(t){t.data.status?(e.noBindDeviceList=t.data.data.records,e.pageParam2.total=t.data.data.total):e.$message.error(t.data.message)}))}},{key:"saveBind",value:function(){var e=this;if(0!==this.selectedSensor.length){this.addLoading=!0;var t=this.selectedSensor.map((function(e){return{deviceId:e.id,gpsMark:!1}}));this.$http.post(h["a"].bindPersonDevice+this.personId,t).then((function(t){e.addLoading=!1,t.data.status?(e.$message.success("绑定成功"),e.noBindDeviceDialogVisible=!1,e.selectedSensor=[],e.getList()):(e.$message.error(t.data.message),e.noBindDeviceDialogVisible=!1)})).catch((function(){e.addLoading=!1}))}else this.$message.info("请选择要绑定的设备")}},{key:"getList",value:function(){var e=this;this.$http.get(h["a"].getPersonDevice+this.personId).then((function(t){t.data.status?e.deviceList=t.data.data:e.$message.error(t.data.message)}))}},{key:"cancelBind",value:function(e){var t=this;_["a"].confirm("确认需要取消绑定？").then((function(){t.$http.post(h["a"].cancelPersonDevice,{objId:t.personId,deviceId:e}).then((function(e){e.data.status?(t.$message.success("操作成功"),t.getList()):t.$message.error(e.data.message)}))})).catch((function(){t.$message.info("已取消")}))}},{key:"bindDevice",value:function(){this.getNoBindList(),this.selectedSensor=[],this.noBindDeviceDialogVisible=!0}},{key:"changeBindGps",value:function(e){var t=this;this.$http.get(h["a"].updateGps+e.personDeviceId,{params:{gpsMark:e.gpsMark}}).then((function(e){e.data.status?(t.getList(),t.$message.success("操作成功")):(t.getList(),t.$message.error(e.data.message))}))}},{key:"mounted",value:function(){this.getList()}}]),t}(p["e"]);u["__decorate"]([Object(p["d"])({type:String})],C.prototype,"personId",void 0),C=u["__decorate"]([Object(p["a"])({})],C);var z=C,B=z,L=(a("7d95"),Object(O["a"])(B,T,S,!1,null,"585a6aeb",null)),j=L.exports,R=a("75fb"),N=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(r["a"])(this,Object(l["a"])(t).apply(this,arguments)),e.loading=!1,e.customOptions=[],e.personDetailsForm={},e.personDetailsFormRules={mobile:[{required:!0,message:"该选项为必填项",trigger:"change"}],typeDetailId:[{required:!0,message:"该选项为必填项",trigger:"change"}],realName:[{required:!0,message:"该选项为必填项",trigger:"change"}],roleIds:[{required:!0,message:"该选项为必填项",trigger:"blur"}],organizationIds:[{required:!0,message:"该选项为必填项",trigger:"blur"}]},e.personTypeVisible=!1,e.personTypeOptions=[],e.orgOptions=[],e.orgVisible=!1,e.roleOptions=[],e.disabled=!1,e.visible=!0,e.pagination={condition:"",tableData:[],currentPage:1,pageSize:10,total:0},e.sensorDialogVisible=!1,e.typeDetailProps={label:"name",value:"id",checkStrictly:!0},e.organizationProps={label:"name",value:"id",checkStrictly:!0,multiple:!0},e.hasCustomRole=qTouch.getBaseTypeByCode("person"),e}return Object(c["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.getRoleList(),this.getPersonTypes(),this.getOrgInfo()}},{key:"listRowIdChange",value:function(){this.listRowId&&this.getPersonInfo()}},{key:"getPersonInfo",value:function(){var e=this;this.loading=!0,this.$http.get(h["a"].getPersonInfoById+"?personId="+this.listRowId).then((function(t){t.data.status?(e.personDetailsForm=t.data.data,e.personDetailsForm.birthDay=e.personDetailsForm.birthDay.trim(),e.personDetailsForm.extInfoVO&&(e.customOptions=e.personDetailsForm.extInfoVO)):e.$message.error(t.data.message)})),this.loading=!1}},{key:"switchToPersonList",value:function(){}},{key:"handleEditPersonType",value:function(){this.personTypeVisible=!0,this.getPersonTypes()}},{key:"getPersonTypes",value:function(){var e=this;this.$http.get(h["a"].findTypeTree+"/person").then((function(t){t.data.status?e.personTypeOptions=t.data.data:e.$message.error(t.data.message)}))}},{key:"handleTypeChange",value:function(e,t,a){t&&this.$refs.personTree.setCheckedKeys([e.id])}},{key:"savePersonType",value:function(){this.$refs.personDetailsForm.validateField("typeDetailId",(function(){})),this.personDetailsForm.typeDetailId&&this.getCustomOptions()}},{key:"getCustomOptions",value:function(){var e=this;this.$http.get(h["a"].getTemplateByTypeDetaiId+"/"+this.personDetailsForm.typeDetailId).then((function(t){t.data.status?e.customOptions=t.data.data:e.$message.error(t.data.message)}))}},{key:"handleEditOrg",value:function(){this.orgVisible=!0,this.getOrgInfo()}},{key:"getOrgInfo",value:function(){var e=this;this.$http.get(h["a"].getNewTypeTree).then((function(t){t.data.status?e.orgOptions=t.data.data:e.$message.error(t.data.message)}))}},{key:"saveOrg",value:function(){this.$refs.personDetailsForm.validateField("organizationIds",(function(){}))}},{key:"getRoleList",value:function(){var e=this;this.$http.get(h["a"].roleList).then((function(t){if(t.data.status){for(var a in e.roleOptions=t.data.data,e.roleOptions)if(e.roleOptions[a].defaultRole){e.personDetailsForm.roleIds=[e.roleOptions[a].id];break}}else e.$message.error(t.data.message)}))}},{key:"customHttpRequest",value:function(e){var t=this,a=g["a"].createUploadForm(e.file);this.$http.post(e.action,a.formData,a.config).then((function(e){e.data.status?(t.personDetailsForm.photo=e.data.data.accessUrl,t.doSave()):t.$message.error(e.data.message)})).finally((function(){t.loading=!1}))}},{key:"getFilledCustomOptions",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.$refs["custom-input"],!t){e.next=5;break}return e.next=4,t.formValidation();case 4:return e.abrupt("return",e.sent);case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"savePerson",value:function(){var e=this;this.$refs.personDetailsForm.validate(function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(a){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=8;break}return t.next=3,e.getFilledCustomOptions();case 3:n=t.sent,n&&(e.personDetailsForm.extInfo=n),e.loading=!0,e.$http.get(h["a"].findByMobile,{params:{mobile:e.personDetailsForm.mobile}}).then((function(t){if(t.data.status)if(t.data.data){var a=t.data.data;a.id!==e.personDetailsForm.accountId?e.$confirm("手机号【"+a.mobile+"】已绑定用户【"+a.realName+"】，是否使用该用户名替换当前用户？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.personDetailsForm.accountId=a.id,e.doSubmit()})):e.doSubmit()}else e.doSubmit();else e.$message.error(t.data.message)})),e.loading=!1;case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"doSubmit",value:function(){this.personDetailsForm.needUpload?(delete this.personDetailsForm.needUpload,this.$refs.upload.submit()):this.doSave()}},{key:"doSave",value:function(){var e=this,t=h["a"].add;this.listRowId&&(t=h["a"].update),this.$http.post(t,this.personDetailsForm).then((function(t){if(t.data.status){e.$message.success(t.data.message),t.data.data&&e.$emit("update:listRowId",t.data.data),e.switchToPersonList();var a=localStorage.getItem("userName");a===e.personDetailsForm.username&&(localStorage.setItem("realName",e.personDetailsForm.realName),qTouch.emit("changeName",e.personDetailsForm.realName))}else e.$message.error(t.data.message)})).finally((function(){e.loading=!1}))}},{key:"dataProcessing",value:function(e){var t=[];return e.forEach((function(e){t.push(e.pop())})),t}},{key:"customChange",value:function(e,t){var a=Object(R["b"])(e.raw),n=a.status,i=a.message;n?(this.$set(this.personDetailsForm,"photo",e.url),this.personDetailsForm.needUpload=!0):(this.$message.error(i),this.$refs.upload.handleRemove(e))}},{key:"handleRemove",value:function(){var e=this;this.personDetailsForm.photo="",this.$nextTick((function(){e.$refs.upload.clearFiles()}))}}]),t}(p["e"]);u["__decorate"]([Object(p["d"])({type:String})],N.prototype,"listRowId",void 0),u["__decorate"]([Object(p["f"])("listRowId",{immediate:!0})],N.prototype,"listRowIdChange",null),u["__decorate"]([Object(p["b"])("switch")],N.prototype,"switchToPersonList",null),N=u["__decorate"]([Object(p["a"])({components:{PersonDevice:j}})],N);var q=N,E=q,M=(a("c114"),Object(O["a"])(E,$,P,!1,null,"7e1834bc",null)),V=M.exports,U=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(r["a"])(this,Object(l["a"])(t).apply(this,arguments)),e.whichComponent="PersonList",e.listRowId="",e}return Object(c["a"])(t,e),Object(o["a"])(t,[{key:"switchComponent",value:function(e,t){switch(e){case"add":this.whichComponent="PersonDetails",this.listRowId="";break;case"edit":this.whichComponent="PersonDetails",this.listRowId=t.id;break;default:this.whichComponent="PersonList"}}}]),t}(p["e"]);U=u["__decorate"]([Object(p["a"])({components:{PersonList:F,PersonDetails:V}})],U);var G=U,A=G,K=Object(O["a"])(A,n,i,!1,null,"436715a0",null);t["default"]=K.exports},"2f89":function(e,t,a){},"3b2b":function(e,t,a){var n=a("7726"),i=a("5dbc"),s=a("86cc").f,o=a("9093").f,r=a("aae3"),l=a("0bfb"),c=n.RegExp,u=c,p=c.prototype,d=/a/g,m=/a/g,g=new c(d)!==d;if(a("9e1e")&&(!g||a("79e5")((function(){return m[a("2b4c")("match")]=!1,c(d)!=d||c(m)==m||"/a/i"!=c(d,"i")})))){c=function(e,t){var a=this instanceof c,n=r(e),s=void 0===t;return!a&&n&&e.constructor===c&&s?e:i(g?new u(n&&!s?e.source:e,t):u((n=e instanceof c)?e.source:e,n&&s?l.call(e):t),a?this:p,c)};for(var h=function(e){e in c||s(c,e,{configurable:!0,get:function(){return u[e]},set:function(t){u[e]=t}})},f=o(u),v=0;f.length>v;)h(f[v++]);p.constructor=c,c.prototype=p,a("2aba")(n,"RegExp",c)}a("7a56")("RegExp")},"46ee":function(e,t,a){"use strict";var n=a("8b4f"),i=a.n(n);i.a},"75fb":function(e,t,a){"use strict";a.d(t,"d",(function(){return n})),a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return r}));a("3b2b");var n=function(e){var t=new RegExp("^[1][3-9][0-9]{9}$");return t.test(e)},i=function(e){var t="image/jpeg"===e.type,a="image/jpg"===e.type,n="image/png"===e.type,i="image/bmp"===e.type,s=e.size/1024/1024<10;return t||a||n||i?s?{status:!0,message:""}:{status:!1,message:"上传图片大小不能超过 10MB!"}:{status:!1,message:"上传图片必须是/jpg/jpeg/png/bmp格式!"}};function s(e){var t={value:e,unit:"KB"};return e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="MB",e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="GB",e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="TB"))),t}function o(e){var t=e.value,a=e.unit;switch(a){case"KB":return Math.floor(t);case"MB":return Math.floor(1024*t);case"GB":return Math.floor(1024*t*1024);case"TB":return Math.floor(1024*t*1024*1024)}}var r=function(e,t){if(console.log(e),t){if(t.formatList&&t.formatList.every((function(t){return e.type!=="image/"+t})))return{status:!1,message:"上传图片必须是/".concat(t.formatList.join("/"),"格式!")};if(t.maxKbSize&&e.size/1024>t.maxKbSize){var a=s(t.maxKbSize);return{status:!1,message:"上传图片大小不能超过 ".concat(a.value).concat(a.unit,"!")}}}return{status:!0,message:""}}},"7d95":function(e,t,a){"use strict";var n=a("8c42"),i=a.n(n);i.a},"8b4f":function(e,t,a){},"8c42":function(e,t,a){},c114:function(e,t,a){"use strict";var n=a("2f89"),i=a.n(n);i.a},ee8b:function(e,t,a){"use strict";a("9e1f"),a("450d");var n=a("6ed5"),i=a.n(n),s={confirm:function(e){return new Promise((function(t,a){i.a.confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t()})).catch((function(){a()}))}))}};t["a"]=s}}]);
//# sourceMappingURL=chunk-38f455c9.f63f4efc.js.map