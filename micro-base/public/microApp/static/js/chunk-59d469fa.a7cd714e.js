(window["webpackJsonpmicro_name_"]=window["webpackJsonpmicro_name_"]||[]).push([["chunk-59d469fa"],{"1a80":function(e,t,a){"use strict";var i=a("7909"),s=a.n(i);s.a},3440:function(e,t,a){"use strict";var i={getPaging:"/admin/car/pagingCar",add:"/admin/car/add",update:"/admin/car/update",delete:"/admin/car/delete",multipleDelete:"/admin/car/multipleDelete",getOneById:"/admin/car/get",getBindDevice:"/admin/carDevice/listDeviceByCarId/carId/",bindDevice:"/admin/carDevice/bind/carId/",cancelBindDevice:"/admin/carDevice/unbind",updateGps:"/admin/carDevice/updateGPSMark/carDeviceId/",findTypeTree:"/admin/typeDetail/findTypeTree",getOrgTreeData:"/admin/organization/orgTree",getNewOrgTree:"/admin/organization/orgTree/car",getTemplateByTypeDetaiId:"/admin/typeDetail/getTemplateByTypeDetaiId",getPersonPaging:"/admin/person/pagingCarPerson",getDevicePaging:"/admin/device/pagingDevice",getTypeDetail:"/admin/typeDetail",deleteType:"/admin/typeDetail/delete",saveCustomAttrItems:"/admin/typeDetail/saveCustomAttrItems",typeTree:{getData:"/admin/typeDetail/findTypeTree/car"},treeItem:{getDetail:"/admin/typeDetail/attr/pagingAttr/car/",add:"/admin/typeDetail/addTypeAndAttrs/car",update:"/admin/typeDetail/updateTypeAndAttrs/car",delete:"/admin/typeDetail/delete/",changeAttrItemMustInput:"/admin/typeDetail/saveCustomAttrItems"},transfer:{getData:"/admin/typeDetail/attr/transferData/car"},carDetail:{getDetail:"/admin/car/get/",getCustom:"/admin/typeDetail/getTemplateByTypeDetaiId/"},download:"/api/excel/download/carTemplate",upload:"/api/excel/upload/carTemplate"};t["a"]=i},"35d8":function(e,t,a){},"3b2b":function(e,t,a){var i=a("7726"),s=a("5dbc"),n=a("86cc").f,l=a("9093").f,o=a("aae3"),r=a("0bfb"),c=i.RegExp,u=c,d=c.prototype,p=/a/g,h=/a/g,m=new c(p)!==p;if(a("9e1e")&&(!m||a("79e5")((function(){return h[a("2b4c")("match")]=!1,c(p)!=p||c(h)==h||"/a/i"!=c(p,"i")})))){c=function(e,t){var a=this instanceof c,i=o(e),n=void 0===t;return!a&&i&&e.constructor===c&&n?e:s(m?new u(i&&!n?e.source:e,t):u((i=e instanceof c)?e.source:e,i&&n?r.call(e):t),a?this:d,c)};for(var g=function(e){e in c||n(c,e,{configurable:!0,get:function(){return u[e]},set:function(t){u[e]=t}})},v=l(u),f=0;v.length>f;)g(v[f++]);d.constructor=c,c.prototype=d,a("2aba")(i,"RegExp",c)}a("7a56")("RegExp")},"40b4":function(e,t,a){"use strict";var i=a("4115"),s=a.n(i);s.a},4115:function(e,t,a){},"75fb":function(e,t,a){"use strict";a.d(t,"d",(function(){return i})),a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return o}));a("3b2b");var i=function(e){var t=new RegExp("^[1][3-9][0-9]{9}$");return t.test(e)},s=function(e){var t="image/jpeg"===e.type,a="image/jpg"===e.type,i="image/png"===e.type,s="image/bmp"===e.type,n=e.size/1024/1024<10;return t||a||i||s?n?{status:!0,message:""}:{status:!1,message:"上传图片大小不能超过 10MB!"}:{status:!1,message:"上传图片必须是/jpg/jpeg/png/bmp格式!"}};function n(e){var t={value:e,unit:"KB"};return e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="MB",e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="GB",e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="TB"))),t}function l(e){var t=e.value,a=e.unit;switch(a){case"KB":return Math.floor(t);case"MB":return Math.floor(1024*t);case"GB":return Math.floor(1024*t*1024);case"TB":return Math.floor(1024*t*1024*1024)}}var o=function(e,t){if(console.log(e),t){if(t.formatList&&t.formatList.every((function(t){return e.type!=="image/"+t})))return{status:!1,message:"上传图片必须是/".concat(t.formatList.join("/"),"格式!")};if(t.maxKbSize&&e.size/1024>t.maxKbSize){var a=n(t.maxKbSize);return{status:!1,message:"上传图片大小不能超过 ".concat(a.value).concat(a.unit,"!")}}}return{status:!0,message:""}}},7909:function(e,t,a){},a324:function(e,t,a){"use strict";var i=a("35d8"),s=a.n(i);s.a},ee8b:function(e,t,a){"use strict";a("9e1f"),a("450d");var i=a("6ed5"),s=a.n(i),n={confirm:function(e){return new Promise((function(t,a){s.a.confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t()})).catch((function(){a()}))}))}};t["a"]=n},efe3:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a(e.whichComponent,{tag:"component",attrs:{listRowId:e.listRowId},on:{switch:e.switchComponent,"update:listRowId":function(t){e.listRowId=t},"update:list-row-id":function(t){e.listRowId=t}}})],1)},s=[],n=a("d225"),l=a("b0b4"),o=a("308d"),r=a("6bb5"),c=a("4e2b"),u=a("9ab4"),d=a("60a3"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("el-input",{staticClass:"input",attrs:{size:"small",placeholder:"请输入编码",maxlength:100,clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getVehicleList(t)}},model:{value:e.pagination.query.code,callback:function(t){e.$set(e.pagination.query,"code",t)},expression:"pagination.query.code"}}),a("el-input",{staticClass:"input",attrs:{size:"small",maxlength:100,placeholder:"请输入车牌号",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getVehicleList(t)}},model:{value:e.pagination.query.licensePlate,callback:function(t){e.$set(e.pagination.query,"licensePlate",t)},expression:"pagination.query.licensePlate"}}),a("q-search-button",{on:{click:e.search}})],1),a("el-button",{attrs:{size:"small",icon:"el-icon-download"},on:{click:e.downloadExcel}},[e._v("下载Excel模板")]),a("el-upload",{ref:"upload",staticStyle:{display:"inline-block","margin-left":"20px","margin-right":"20px"},attrs:{action:e.uploadProcessFileUrl,"show-file-list":!1,headers:e.httpHeaders,"on-success":e.uploadFileSuccess,"on-error":e.uploadFileError,multiple:"",limit:1,"file-list":e.uploadFileList}},[a("el-button",{attrs:{size:"small",icon:"el-icon-upload"}},[e._v("批量导入")])],1),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:function(t){return e.switchToVehicleDetails("add")}}},[e._v("添加 ")])],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"margin-top":"20px"}},[a("el-table",{staticStyle:{width:"100%","min-height":"calc(100vh - 300px)"},attrs:{data:e.pagination.tableData}},[a("el-table-column",{attrs:{align:"center",label:"序号",type:"index",index:e.indexCustom,width:"100"}}),a("el-table-column",{attrs:{prop:"code",label:"车辆编码","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"licensePlate",label:"车牌号","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"typeDetailName",label:"车辆类型","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"orgName",label:"所属组织","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"isStarted",label:"是否启用"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?a("span",{staticStyle:{"font-size":"12px"}},[e._v("是")]):a("span",{staticStyle:{"font-size":"12px"}},[e._v("否")])]}}])}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.switchToVehicleDetails("edit",t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1),a("q-pagination",{attrs:{"current-page":e.pagination.current,size:"small","page-size":e.pagination.size,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.pagination,"current",t)},"update:current-page":function(t){return e.$set(e.pagination,"current",t)}}})],1)},h=[],m=a("3440"),g=a("c195"),v=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(o["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.pagination={query:{},tableData:[],current:1,page:15,total:0},e.loading=!1,e.multipleSelection=[],e.indexCustom=0,e.uploadProcessFileUrl=m["a"].upload,e.httpHeaders={accessToken:"Bearer "+g["a"].get("accessToken")},e.uploadFileList=[],e}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"created",value:function(){this.getVehicleList()}},{key:"switchToVehicleDetails",value:function(){}},{key:"search",value:function(){this.pagination.current=1,this.getVehicleList()}},{key:"getVehicleList",value:function(){var e=this;this.loading=!0,this.$http.post(m["a"].getPaging,this.pagination).then((function(t){e.loading=!1,t.data.status?(e.pagination.tableData=t.data.data.records,e.pagination.total=t.data.data.total,e.indexCustom=(t.data.data.current-1)*t.data.data.size+1):e.$message.error(t.data.message)})).catch((function(){e.loading=!1}))}},{key:"handleCurrentChange",value:function(e){this.pagination.current=e,this.getVehicleList()}},{key:"handleSizeChange",value:function(e){this.pagination.size=e,this.getVehicleList()}},{key:"deleteVehicles",value:function(e){var t=this;0!==e.length?this.$confirm("是否删除车辆相关数据？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$http.post(m["a"].multipleDelete,e).then((function(a){a.data.status?(t.$message.success(a.data.message),t.pagination.tableData.length===e.length?t.pagination.current--:t.pagination.current,t.getVehicleList()):t.$message.error(a.data.message)})).catch((function(e){t.$message.error("删除失败")}))})).catch((function(){})):this.$message.warning("请选择要删除的数据！")}},{key:"handleDelete",value:function(e){var t=[];t.push(e.id),this.deleteVehicles(t)}},{key:"downloadExcel",value:function(){var e=document.createElement("a");e.href=m["a"].download,e.click()}},{key:"uploadFileSuccess",value:function(e,t){e.status?(this.$message.success(e.message),this.getVehicleList()):(this.$message.error(e.message),this.getVehicleList())}},{key:"uploadFileError",value:function(){this.$message.error("操作失败！")}}]),t}(d["e"]);u["__decorate"]([Object(d["b"])("switch")],v.prototype,"switchToVehicleDetails",null),v=u["__decorate"]([Object(d["a"])({})],v);var f=v,b=f,y=(a("a324"),a("2877")),D=Object(y["a"])(b,p,h,!1,null,"02cd1217",null),w=D.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.doLoading,expression:"doLoading"}],staticClass:"container"},[a("el-button",{staticClass:"back",attrs:{size:"small"},on:{click:e.switchToVehicleList}},[e._v("返回")]),a("el-tabs",{attrs:{type:"card"}},[a("el-tab-pane",{staticClass:"content",attrs:{label:"基本信息"}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],ref:"vehicleDetailsForm",staticStyle:{"margin-top":"20px"},attrs:{size:"small","label-width":"100px",model:e.vehicleDetailsForm,rules:e.vehicleDetailsFormRules}},[a("el-row",{attrs:{gutter:0}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"车辆编码：",prop:"code"}},[a("el-input",{attrs:{disabled:e.disabled,maxlength:100,placeholder:"包含字母、数字、横线、下划线和点,点不能作为开头,长度3-100位"},model:{value:e.vehicleDetailsForm.code,callback:function(t){e.$set(e.vehicleDetailsForm,"code",t)},expression:"vehicleDetailsForm.code"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"车牌号：",prop:"licensePlate"}},[a("el-input",{attrs:{placeholder:"请输入",maxlength:100,disabled:e.disabled},model:{value:e.vehicleDetailsForm.licensePlate,callback:function(t){e.$set(e.vehicleDetailsForm,"licensePlate",t)},expression:"vehicleDetailsForm.licensePlate"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"车辆类型：",prop:"typeDetailId"}},[a("q-tree",{attrs:{"tree-data":e.vehicleTypeOptions,"tree-prop":{value:"id",label:"name"},title:"车辆类型",multi:!1,"need-stringify":!0,closable:!1},on:{qClick:e.saveType},model:{value:e.vehicleDetailsForm.typeDetailId,callback:function(t){e.$set(e.vehicleDetailsForm,"typeDetailId",t)},expression:"vehicleDetailsForm.typeDetailId"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"是否启用：",prop:"status"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:e.disabled},model:{value:e.vehicleDetailsForm.status,callback:function(t){e.$set(e.vehicleDetailsForm,"status",t)},expression:"vehicleDetailsForm.status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"所属组织：",prop:"orgId"}},[a("q-tree",{attrs:{"tree-data":e.orgOptions,"tree-prop":{value:"id",label:"name"},title:"所属组织",multi:!1,"need-stringify":!0,closable:!1},on:{qClick:e.saveOrg},model:{value:e.vehicleDetailsForm.orgId,callback:function(t){e.$set(e.vehicleDetailsForm,"orgId",t)},expression:"vehicleDetailsForm.orgId"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"所属人员：",prop:"personId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:e.disabled,filterable:"",remote:"","remote-method":e.remoteMethod},model:{value:e.vehicleDetailsForm.personId,callback:function(t){e.$set(e.vehicleDetailsForm,"personId",t)},expression:"vehicleDetailsForm.personId"}},e._l(e.staffsOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.realName,value:e.id}})})),1)],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"责任单位：",prop:"unitId"}},[a("el-input",{attrs:{placeholder:"请输入",maxlength:100,disabled:e.disabled},model:{value:e.vehicleDetailsForm.unitId,callback:function(t){e.$set(e.vehicleDetailsForm,"unitId",t)},expression:"vehicleDetailsForm.unitId"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"购置时间：",prop:"buyDate"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",clearable:"",placeholder:"选择日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd hh:mm:ss",disabled:e.disabled},model:{value:e.vehicleDetailsForm.buyDate,callback:function(t){e.$set(e.vehicleDetailsForm,"buyDate",t)},expression:"vehicleDetailsForm.buyDate"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"上传图片："}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.vehicleDetailsForm.image,expression:"vehicleDetailsForm.image"}],staticClass:"upload-img"},[a("img",{attrs:{src:e.vehicleDetailsForm.image,alt:""}}),a("div",{staticClass:"mask",on:{click:e.handleRemove}},[a("i",{staticClass:"el-icon-delete"})])]),a("el-upload",{directives:[{name:"show",rawName:"v-show",value:!e.vehicleDetailsForm.image,expression:"!vehicleDetailsForm.image"}],ref:"upload",attrs:{action:"/api/file/upload","list-type":"picture-card","http-request":e.customHttpRequest,"on-change":e.customChange,accept:"image/jpeg,image/png,image/jpg",disabled:e.disabled,"auto-upload":!1,multiple:!1,"show-file-list":!1,limit:1}},[a("i",{staticClass:"el-icon-plus"})])],1)],1)],1),e.hasCustomRole?[a("div",[a("el-button",{attrs:{type:"text",disabled:""}},[e._v("\n              自定义属性\n            ")])],1),a("div",{staticClass:"customRow"},[a("q-custom-input",{ref:"custom-input",attrs:{customOptions:e.customOptions}})],1)]:e._e()],2),a("div",{staticClass:"block"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],attrs:{type:"primary",size:"small"},on:{click:e.saveVehicle}},[e._v("保存 ")])],1)],1),e.listRowId?a("el-tab-pane",{staticClass:"content",attrs:{label:"设备绑定"}},[a("vechicle-device",{staticStyle:{"margin-top":"20px"},attrs:{vehicleId:e.listRowId}})],1):e._e()],1),a("el-dialog",{attrs:{title:"传感器",visible:e.sensorDialogVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.sensorDialogVisible=t}}},[a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.sensorDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("确 定")])],1)])],1)},x=[],O=(a("28a5"),a("96cf"),a("3b8d")),I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"person-wrapper"},[a("div",{staticClass:"card-header"},[a("i",{staticClass:"el-icon-info header-icon"}),a("div",{staticClass:"header-title"},[e._v("设备绑定")]),a("el-button",{staticStyle:{float:"right","margin-top":"5px"},attrs:{size:"small",icon:"el-icon-plus",type:"primary"},on:{click:e.bindVechcle}},[e._v("添加设备 ")])],1),a("el-table",{staticStyle:{width:"100%","margin-top":"20px",height:"calc(100vh - 315px)"},attrs:{data:e.Vehicle}},[a("el-table-column",{attrs:{align:"center",prop:"id",label:"序号",type:"index",width:"100"}}),a("el-table-column",{attrs:{align:"center",prop:"code",label:"设备编码","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",prop:"name",label:"设备名称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",prop:"typeDetailName",label:"设备类型","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"图片详情"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.image?a("el-image",{staticStyle:{height:"40px",width:"60px","margin-top":"6px"},attrs:{src:t.row.image}}):[e._v("\n          暂无图片\n        ")]]}}])}),a("el-table-column",{attrs:{align:"center",label:"是否有效"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{domProps:{textContent:e._s(!0===t.row.status?"有效":"无效")}})]}}])}),a("el-table-column",{attrs:{align:"center",label:"GPS设备"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-text":"是","inactive-text":"否","active-value":!0,"inactive-value":!1},on:{change:function(a){return e.changeBindGps(t.row)}},model:{value:t.row.gpsMark,callback:function(a){e.$set(t.row,"gpsMark",a)},expression:"scope.row.gpsMark"}})]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.cancelBind(t.row.id)}}},[e._v("取消绑定")])]}}])})],1),a("el-dialog",{attrs:{title:"未绑定的设备列表",visible:e.noBindVechcleDialogVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.noBindVechcleDialogVisible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-input",{staticStyle:{width:"240px","margin-right":"10px"},attrs:{size:"small",maxlength:100,placeholder:"输入需要查询的设备名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getNoBindList(t)}},model:{value:e.pageParam2.query.name,callback:function(t){e.$set(e.pageParam2.query,"name",t)},expression:"pageParam2.query.name"}}),a("q-search-button",{on:{click:e.getNoBindList}}),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"20px","min-height":"400px"},attrs:{data:e.noBindVehicle},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",prop:"id",label:"序号",type:"index",width:"100"}}),a("el-table-column",{attrs:{prop:"code",label:"设备编码","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"name",label:"设备名称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"typeDetailName",label:"设备类型","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"图片详情"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.image?a("el-image",{staticStyle:{height:"40px",width:"60px","margin-top":"6px"},attrs:{src:t.row.image}}):[e._v("\n              暂无图片\n            ")]]}}])})],1),a("div",{staticStyle:{width:"100%"}},[a("q-pagination",{attrs:{"current-page":e.pageParam2.current,"page-sizes":[10,20,30,40],"page-size":e.pageParam2.size,layout:"total, sizes, prev, pager, next, jumper",total:e.pageParam2.total},on:{"size-change":e.handleSizeChange2,"current-change":e.handleCurrentChange2}})],1),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.noBindVechcleDialogVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.saveBind}},[e._v("确定")])],1)],1)])],1)},C=[],F=a("ee8b"),$=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(o["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.Vehicle=[],e.noBindVehicle=[],e.noBindVechcleDialogVisible=!1,e.selectedSensor=[],e.pageParam={size:10,current:1,query:e.vehicleId,total:0},e.pageParam2={size:8,current:1,total:0,query:{name:""}},e.loading=!1,e}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"handleSizeChange2",value:function(e){this.pageParam2.size=e,this.getNoBindList()}},{key:"handleCurrentChange2",value:function(e){this.pageParam2.current=e,this.getNoBindList()}},{key:"handleSelectionChange",value:function(e){this.selectedSensor=e}},{key:"getNoBindList",value:function(){var e=this;this.pageParam2.query.bound=!1,this.$http.post(m["a"].getDevicePaging,this.pageParam2).then((function(t){t.data.status?(e.noBindVehicle=t.data.data.records,e.pageParam2.total=t.data.data.total):e.$message.error(t.data.message)}))}},{key:"saveBind",value:function(){var e=this;if(0!==this.selectedSensor.length){this.loading=!0;var t=this.selectedSensor.map((function(e){return{deviceId:e.id,gpsMark:!1}}));this.$http.post(m["a"].bindDevice+this.vehicleId,t).then((function(t){e.loading=!1,t.data.status?(e.$message.success("绑定成功"),e.noBindVechcleDialogVisible=!1,e.selectedSensor=[],e.getList(),e.getNoBindList()):(e.$message.error(t.data.message),e.noBindVechcleDialogVisible=!1)})).catch((function(){e.loading=!1}))}else this.$message.info("请选择要绑定的设备")}},{key:"getList",value:function(){var e=this;this.$http.get(m["a"].getBindDevice+this.vehicleId).then((function(t){t.data.status?e.Vehicle=t.data.data:e.$message.error(t.data.message)}))}},{key:"handleSize",value:function(e){this.pageParam.size=e,this.getList()}},{key:"handleCurrent",value:function(e){this.pageParam.current=e,this.getList()}},{key:"cancelBind",value:function(e){var t=this;F["a"].confirm("确认需要取消绑定？").then((function(){t.$http.post(m["a"].cancelBindDevice,{objId:t.vehicleId,deviceId:e}).then((function(e){e.data.status?(t.$message.success("操作成功"),t.getList()):t.$message.error(e.data.message)}))}))}},{key:"changeBindGps",value:function(e){var t=this;this.$http.get(m["a"].updateGps+e.personDeviceId,{params:{gpsMark:e.gpsMark}}).then((function(a){a.data.status?(t.getList(),t.$message.success("操作成功")):(e.gpsMark=!e.gpsMark,t.$message.error(a.data.message))}))}},{key:"bindVechcle",value:function(){this.selectedSensor=[],this.getNoBindList(),this.noBindVechcleDialogVisible=!0}},{key:"mounted",value:function(){this.getList()}}]),t}(d["e"]);u["__decorate"]([Object(d["d"])({type:String})],$.prototype,"vehicleId",void 0),$=u["__decorate"]([Object(d["a"])({})],$);var V=$,_=V,T=(a("40b4"),Object(y["a"])(_,I,C,!1,null,"e2500f60",null)),z=T.exports,S=a("73ec"),j=a("75fb"),B=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(o["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.loading=!1,e.doLoading=!1,e.formLoading=!1,e.customOptions=[],e.vehicleDetailsForm={},e.filterOrgId="",e.vehicleDetailsFormRules={licensePlate:{required:!0,message:"该选项为必填项",trigger:"change"},orgId:{required:!0,message:"该选项为必填项",trigger:"change"},typeDetailId:{required:!0,message:"该选项为必填项",trigger:"change"},status:{required:!0,message:"该选项为必填项",trigger:"change"}},e.vehicleTypeOptions=[],e.typeVisible=!1,e.orgOptions=[],e.orgVisible=!1,e.staffsOptions=[],e.statusOptions=[{value:!0,label:"是"},{value:!1,label:"否"}],e.disabled=!1,e.visible=!0,e.pagination={query:{},tableData:[],current:1,size:10,total:0},e.sensorDialogVisible=!1,e.typeDetailProps={label:"name",value:"id",checkStrictly:!0},e.hasCustomRole=qTouch.getBaseTypeByCode("car"),e}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"WatchFilterOrg",value:function(e,t){this.vehicleDetailsForm.orgId=S["a"].lastOfArr(this.filterOrgId)}},{key:"handleIdChange",value:function(){this.listRowId&&this.getCarInfo(this.listRowId),this.getPersonList(""),this.getOrganizations(),this.getVehicleTypes()}},{key:"switchToVehicleList",value:function(){}},{key:"getCarInfo",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(t){var a,i,s,n,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$http.get(m["a"].carDetail.getDetail+t);case 3:a=e.sent,i=a.data,s=i.data,n=i.status,l=i.message,n?(this.vehicleDetailsForm=s,this.vehicleDetailsForm.extInfoVO&&(this.customOptions=this.vehicleDetailsForm.extInfoVO),this.filterOrgId=null==this.vehicleDetailsForm.orgId?[]:this.vehicleDetailsForm.orgId.split(",")):this.$message.error(l),e.next=14;break;case 11:return e.prev=11,e.t0=e["catch"](0),e.abrupt("return",this.$message.error("请求失败，请重试！"));case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getVehicleTypes",value:function(){var e=this;this.typeVisible=!0,this.$http.get(m["a"].findTypeTree+"/car").then((function(t){if(t.data.status){var a=t.data.data;e.vehicleTypeOptions=a||[]}else e.$message.error(t.data.message)}))}},{key:"handleTypeChange",value:function(e,t,a){t&&this.$refs.typeTree.setCheckedKeys([e.id])}},{key:"saveType",value:function(){this.$refs.vehicleDetailsForm.validateField("typeDetailId",(function(){})),this.vehicleDetailsForm.typeDetailId&&this.getCustomOptions()}},{key:"getOrganizations",value:function(){var e=this;this.orgVisible=!0,this.$http.get(m["a"].getNewOrgTree).then((function(t){t.data.status?e.orgOptions=t.data.data:e.$message.error(t.data.message)}))}},{key:"handleOrgChange",value:function(e,t,a){t&&this.$refs.orgTree.setCheckedKeys([e.id])}},{key:"saveOrg",value:function(){}},{key:"getCustomOptions",value:function(){var e=this;this.$http.get(m["a"].carDetail.getCustom+this.vehicleDetailsForm.typeDetailId).then((function(t){t.data.status?e.customOptions=t.data.data:e.$message.error(t.data.message)}))}},{key:"getPersonList",value:function(e){var t=this;this.$http.post(m["a"].getPersonPaging,{current:1,size:100,total:0,query:{name:e,organizationId:this.vehicleDetailsForm.orgId}}).then((function(e){e.status&&(e.data.status?t.staffsOptions=e.data.data.records:t.$message.error(e.data.message))}))}},{key:"remoteMethod",value:function(e){this.getPersonList(e)}},{key:"sensorIntroduction",value:function(){this.sensorDialogVisible=!0}},{key:"getFilledCustomOptions",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.$refs["custom-input"],!t){e.next=5;break}return e.next=4,t.formValidation();case 4:return e.abrupt("return",e.sent);case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"saveVehicle",value:function(){var e=this;this.$refs.vehicleDetailsForm.validate((function(t){t&&(e.vehicleDetailsForm.needUpload?(delete e.vehicleDetailsForm.needUpload,e.$refs.upload.submit()):e.doSubmit())}))}},{key:"doSubmit",value:function(){var e=Object(O["a"])(regeneratorRuntime.mark((function e(){var t,a,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getFilledCustomOptions();case 2:t=e.sent,t&&(this.vehicleDetailsForm.extInfo=t),delete this.vehicleDetailsForm.extInfoVO,this.doLoading=!0,a=m["a"].add,this.listRowId&&(a=m["a"].update),this.$http.post(a,this.vehicleDetailsForm).then((function(e){i.doLoading=!1,e.data.status?(i.$message.success(e.data.message),e.data.data&&i.$emit("update:listRowId",e.data.data),i.switchToVehicleList()):i.$message.error(e.data.message)}));case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"customHttpRequest",value:function(e){var t=this;this.loading=!0;var a=S["a"].createUploadForm(e.file);this.$http.post(e.action,a.formData,a.config).then((function(e){t.loading=!1,e.data.status?(t.vehicleDetailsForm.image=e.data.data.accessUrl,t.doSubmit()):t.$message.error(e.data.message)}))}},{key:"customChange",value:function(e,t){var a=Object(j["b"])(e.raw),i=a.status,s=a.message;i?(this.$set(this.vehicleDetailsForm,"image",e.url),this.vehicleDetailsForm.needUpload=!0):(this.$message.error(s),this.$refs.upload.handleRemove(e))}},{key:"handleRemove",value:function(){var e=this;this.vehicleDetailsForm.image="",this.$nextTick((function(){e.$refs.upload.clearFiles()}))}}]),t}(d["e"]);u["__decorate"]([Object(d["d"])({type:String,required:!0})],B.prototype,"listRowId",void 0),u["__decorate"]([Object(d["f"])("filterOrgId")],B.prototype,"WatchFilterOrg",null),u["__decorate"]([Object(d["f"])("listRowId",{immediate:!0})],B.prototype,"handleIdChange",null),u["__decorate"]([Object(d["b"])("switch")],B.prototype,"switchToVehicleList",null),B=u["__decorate"]([Object(d["a"])({components:{VechicleDevice:z}})],B);var L=B,P=L,R=(a("1a80"),Object(y["a"])(P,k,x,!1,null,"6fc609ab",null)),q=R.exports,M=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(o["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.whichComponent="VehicleList",e.listRowId="",e}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"switchComponent",value:function(e,t){switch(e){case"add":this.whichComponent="VehicleDetails",this.listRowId="";break;case"edit":this.whichComponent="VehicleDetails",this.listRowId=t.id;break;default:this.whichComponent="VehicleList"}}}]),t}(d["e"]);M=u["__decorate"]([Object(d["a"])({components:{VehicleList:w,VehicleDetails:q}})],M);var N=M,E=N,A=Object(y["a"])(E,i,s,!1,null,"06fb4e0c",null);t["default"]=A.exports}}]);
//# sourceMappingURL=chunk-59d469fa.a7cd714e.js.map