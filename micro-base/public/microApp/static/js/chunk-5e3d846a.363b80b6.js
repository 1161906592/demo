(window["webpackJsonpmicro_name_"]=window["webpackJsonpmicro_name_"]||[]).push([["chunk-5e3d846a"],{"08bc":function(e,t,a){"use strict";var i=a("c477"),o=a.n(i);o.a},"0d6d":function(e,t,a){var i=a("d3f4"),o=a("67ab").onFreeze;a("5eda")("freeze",(function(e){return function(t){return e&&i(t)?e(o(t)):t}}))},"298e":function(e,t,a){},"3b2b":function(e,t,a){var i=a("7726"),o=a("5dbc"),n=a("86cc").f,l=a("9093").f,s=a("aae3"),r=a("0bfb"),c=i.RegExp,d=c,u=c.prototype,p=/a/g,m=/a/g,g=new c(p)!==p;if(a("9e1e")&&(!g||a("79e5")((function(){return m[a("2b4c")("match")]=!1,c(p)!=p||c(m)==m||"/a/i"!=c(p,"i")})))){c=function(e,t){var a=this instanceof c,i=s(e),n=void 0===t;return!a&&i&&e.constructor===c&&n?e:o(g?new d(i&&!n?e.source:e,t):d((i=e instanceof c)?e.source:e,i&&n?r.call(e):t),a?this:u,c)};for(var f=function(e){e in c||n(c,e,{configurable:!0,get:function(){return d[e]},set:function(t){d[e]=t}})},h=l(d),v=0;h.length>v;)f(h[v++]);u.constructor=c,c.prototype=u,a("2aba")(i,"RegExp",c)}a("7a56")("RegExp")},"3df1":function(e,t,a){"use strict";var i=a("bfaa"),o=a.n(i);o.a},"43d6":function(e,t,a){},5538:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a(e.whichComponent,{tag:"component",attrs:{listRowId:e.listRowId},on:{switch:e.switchComponent,"update:listRowId":function(t){e.listRowId=t},"update:list-row-id":function(t){e.listRowId=t}}})],1)},o=[],n=a("d225"),l=a("b0b4"),s=a("308d"),r=a("6bb5"),c=a("4e2b"),d=a("9ab4"),u=a("60a3"),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("el-input",{staticClass:"input",attrs:{size:"small",maxlength:100,placeholder:"建筑名",clearable:""},nativeOn:{keyp:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.pagination.query.name,callback:function(t){e.$set(e.pagination.query,"name",t)},expression:"pagination.query.name"}}),a("q-search-button",{on:{click:e.search}})],1),a("div",[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:function(t){return e.switchToDetails("add")}}},[e._v("添加")]),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"small"},on:{click:e.multipleDelete}},[e._v("删除")])],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"margin-top":"20px"}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","min-height":"calc(100vh - 296px)"},attrs:{data:e.tableData},on:{"selection-change":e.getAllSelected}},[a("el-table-column",{attrs:{align:"center",type:"selection","min-width":"60"}}),a("el-table-column",{attrs:{align:"center",prop:"id",label:"序号",type:"index",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.$index+(e.pagination.current-1)*e.pagination.size+1)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"name",label:"建筑名称","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"code",label:"建筑编码","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"typeDetailName",label:"建筑类型","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"orgName",label:"所属组织","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"area",label:"建筑面积","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"address",label:"建筑地址","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"image",label:"图片","min-width":"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{staticClass:"img-wrap"},[t.row.image?a("el-image",{staticClass:"img",attrs:{src:t.row.image,fit:"contain"}}):[e._v("\n            暂无图片\n          ")]],2)}}])}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"big",type:"text",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){return e.switchToDetails("edit",t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"big",type:"text",icon:"el-icon-delete",title:"删除"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1),a("q-pagination",{attrs:{"current-page":e.pagination.current,size:"small","page-size":e.pagination.size,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.pagination,"current",t)},"update:current-page":function(t){return e.$set(e.pagination,"current",t)}}})],1)},m=[],g=(a("ac6a"),a("7d19")),f=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(s["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.tableData=[],e.pagination={current:1,size:10,total:0,query:{name:"",code:"",typeDetailId:""}},e.loading=!1,e.multipleSelection=[],e}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"search",value:function(){this.pagination.current=1,this.getList()}},{key:"getList",value:function(){var e=this;this.loading=!0,this.$http.post(g["a"].getPaging,this.pagination).then((function(t){e.loading=!1,t.data.status?(e.tableData=t.data.data.records,e.pagination.total=t.data.data.total):e.$message.error(t.data.message)})).catch((function(){e.loading=!1}))}},{key:"handleCurrentChange",value:function(e){this.pagination.current=e,this.getList()}},{key:"handleSizeChange",value:function(e){this.pagination.size=e,this.getList()}},{key:"getAllSelected",value:function(e){this.multipleSelection=e}},{key:"handleDelete",value:function(e){var t=[];t.push(e.id),this.delete(t)}},{key:"multipleDelete",value:function(){var e=[];this.multipleSelection.forEach((function(t){e.push(t.id)})),this.delete(e)}},{key:"delete",value:function(e){var t=this;0===e.length?this.$message.warning("请选择要删除的数据！"):this.$confirm("是否确认删除数据？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$http.post(g["a"].multipleDelete,e).then((function(a){a.data.status?(t.$message.success(a.data.message),t.tableData.length===e.length&&0!=t.pagination.current&&(t.pagination.current-=1),t.getList()):t.$message.error(a.data.message)}))}))}},{key:"switchToDetails",value:function(){}},{key:"mounted",value:function(){this.getList()}}]),t}(u["e"]);d["__decorate"]([Object(u["b"])("switch")],f.prototype,"switchToDetails",null),f=d["__decorate"]([Object(u["a"])({})],f);var h=f,v=h,b=(a("3df1"),a("2877")),y=Object(b["a"])(v,p,m,!1,null,"ce1670c2",null),w=y.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("el-button",{staticClass:"back",attrs:{size:"small"},on:{click:function(t){return e.switchToList("back")}}},[e._v("返回")]),a("el-tabs",{staticClass:"content",attrs:{type:"card"}},[a("el-tab-pane",{staticClass:"pane-content",attrs:{label:"基本信息"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-form",{ref:"detailsForm",staticClass:"form",attrs:{size:"small","label-width":"100px",model:e.detailsForm,rules:e.detailsFormRules}},[a("el-row",{attrs:{gutter:0}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"建筑名称：",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入",maxlength:100,disabled:e.disabled},model:{value:e.detailsForm.name,callback:function(t){e.$set(e.detailsForm,"name",t)},expression:"detailsForm.name"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"建筑编码：",prop:"code"}},[a("el-input",{attrs:{placeholder:"包含字母、数字、横线、下划线和点,点不能作为开头,长度3-100位",maxlength:100,disabled:e.disabled},model:{value:e.detailsForm.code,callback:function(t){e.$set(e.detailsForm,"code",t)},expression:"detailsForm.code"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"建筑类型：",prop:"typeDetailId"}},[a("q-tree",{attrs:{"tree-data":e.typeDetailOptions,"tree-prop":{value:"id",label:"name"},title:"建筑类型",multi:!1,"need-stringify":!0,closable:!1},on:{qClick:e.saveType},model:{value:e.detailsForm.typeDetailId,callback:function(t){e.$set(e.detailsForm,"typeDetailId",t)},expression:"detailsForm.typeDetailId"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"所属组织：",prop:"orgId"}},[a("q-tree",{attrs:{"tree-data":e.orgOptions,"tree-prop":{value:"id",label:"name"},title:"所属组织",multi:!1,"need-stringify":!0,closable:!1},on:{qClick:e.saveOrg},model:{value:e.detailsForm.orgId,callback:function(t){e.$set(e.detailsForm,"orgId",t)},expression:"detailsForm.orgId"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"建筑面积：",prop:"area"}},[a("el-input",{attrs:{type:"number",placeholder:"请输入",disabled:e.disabled},model:{value:e.detailsForm.area,callback:function(t){e.$set(e.detailsForm,"area",t)},expression:"detailsForm.area"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"建筑地址：",prop:"address"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.detailsForm.address,expression:"detailsForm.address"}],staticStyle:{"margin-right":"20px"}},[e._v(e._s(e.detailsForm.address))]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.disabled},on:{click:e.bindAddress}},[e._v(e._s(e.detailsForm.location?"查看":"绑定")+"\n                ")])],1)],1)],1),a("el-row",[a("el-form-item",{attrs:{label:"上传图片："}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.detailsForm.image,expression:"detailsForm.image"}],staticClass:"upload-img"},[a("img",{attrs:{src:e.detailsForm.image,alt:""}}),a("div",{staticClass:"mask",on:{click:e.handleRemove}},[a("i",{staticClass:"el-icon-delete"})])]),a("el-upload",{directives:[{name:"show",rawName:"v-show",value:!e.detailsForm.image,expression:"!detailsForm.image"}],ref:"upload",attrs:{action:"/api/file/upload","list-type":"picture-card","http-request":e.customHttpRequest,"on-change":e.customChange,accept:"image/jpeg,image/png,image/jpg",disabled:e.disabled,"auto-upload":!1,multiple:!1,"show-file-list":!1,limit:1}},[a("i",{staticClass:"el-icon-plus"})])],1)],1)],1),e.hasCustomRole?[a("div",[a("el-button",{attrs:{type:"text",disabled:""}},[e._v("自定义属性")])],1),a("div",{staticClass:"customRow"},[a("q-custom-input",{ref:"custom-input",attrs:{customOptions:e.customOptions}})],1)]:e._e(),a("div",{staticClass:"footer-btn"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],attrs:{type:"primary",size:"small"},on:{click:e.saveInfo}},[e._v("保存")])],1)],2)]),e.listRowId?a("el-tab-pane",{staticClass:"pane-content",attrs:{label:"楼层信息"}},[a("el-row",{staticClass:"floorRow",attrs:{gutter:0}},[a("building-floor-list",{ref:"building-floor",attrs:{buildingId:e.listRowId}})],1)],1):e._e(),e.listRowId?a("el-tab-pane",{staticClass:"panel-content",attrs:{label:"设备绑定"}},[a("building-floor-device",{attrs:{buildId:e.listRowId}})],1):e._e()],1),a("el-dialog",{attrs:{title:"建筑位置选择","close-on-click-modal":!1,visible:e.addressDialog,width:"980px"},on:{"update:visible":function(t){e.addressDialog=t},close:e.destroyMap}},[a("div",{staticStyle:{position:"relative"}},[a("div",{staticClass:"message"},[a("span",[e._v(e._s(e.text))]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showLeaveChoose,expression:"showLeaveChoose"}],staticStyle:{float:"right",margin:"4px 10px"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.chooseOff}},[e._v("取消选取")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.showLeaveChoose,expression:"!showLeaveChoose"}],staticStyle:{float:"right",margin:"4px 10px"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.chooseSiteOnMap}},[e._v("重新绑定")])],1)]),a("el-card",{staticClass:"card-content",attrs:{id:"buildAmap"}}),a("div",{staticClass:"picker-box"},[a("input",{staticClass:"inp",attrs:{id:"buildInput",placeholder:"输入关键字选取地点"}})])],1)])],1)},F=[],I=(a("6b54"),a("7f7f"),a("0d6d"),a("96cf"),a("3b8d")),x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%"}},[a("div",{staticClass:"table-content"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("el-input",{staticStyle:{width:"240px","margin-right":"10px"},attrs:{size:"small",maxlength:100,placeholder:"楼层名称",clearable:""},on:{clear:e.getFloorList},model:{value:e.pagination.query.name,callback:function(t){e.$set(e.pagination.query,"name",t)},expression:"pagination.query.name"}}),a("q-search-button",{on:{click:e.getFloorList}})],1),a("el-button",{attrs:{size:"small",icon:"el-icon-plus",type:"primary"},on:{click:e.addFloorForm}},[e._v("添加")])],1),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","min-height":"calc(100vh - 355px)"},attrs:{data:e.floorTableData}},[a("el-table-column",{attrs:{align:"center",label:"序号",type:"index",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.$index+(e.pagination.current-1)*e.pagination.size+1)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"code",label:"楼层编号","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"name",label:"楼层名称","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"area",label:"楼层面积","min-width":"","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"image",label:"图片","min-width":"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{staticClass:"img-wrap"},[t.row.image?a("el-image",{staticClass:"img",attrs:{src:t.row.image,fit:"contain"}}):[e._v("\n              暂无图片\n            ")]],2)}}])}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-edit",title:"编辑"},on:{click:function(a){return e.editFloor(t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"small",type:"text",icon:"el-icon-delete",title:"删除"},on:{click:function(a){return e.handleFloorDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),a("q-pagination",{attrs:{"current-page":e.pagination.current,small:"",background:"","page-size":e.pagination.size,layout:"total, prev, pager, next, jumper",total:e.pagination.total},on:{"current-change":e.getFloorList,"update:currentPage":function(t){return e.$set(e.pagination,"current",t)},"update:current-page":function(t){return e.$set(e.pagination,"current",t)}}})],1),e.floorDialogVisible?a("el-dialog",{attrs:{title:"楼层信息",visible:e.floorDialogVisible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.floorDialogVisible=t},close:e.closeDialog}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("div",{staticClass:"card-header"},[a("i",{staticClass:"el-icon-info header-icon"}),a("div",{staticClass:"header-title"},[e._v("基本信息")])]),a("el-form",{ref:"floorInfoForm",staticStyle:{"min-height":"300px","margin-top":"10px"},attrs:{size:"small","label-width":"150px",model:e.floorInfoForm,rules:e.floorFormRules}},[a("el-row",{attrs:{gutter:0}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"楼层名称：",prop:"name"}},[a("el-input",{attrs:{maxlength:100,placeholder:"请输入"},model:{value:e.floorInfoForm.name,callback:function(t){e.$set(e.floorInfoForm,"name",t)},expression:"floorInfoForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"楼层编号：",prop:"code"}},[a("el-input",{attrs:{maxlength:100,placeholder:"请输入"},model:{value:e.floorInfoForm.code,callback:function(t){e.$set(e.floorInfoForm,"code",t)},expression:"floorInfoForm.code"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"楼层面积：",prop:"area"}},[a("el-input",{attrs:{type:"number",placeholder:"请输入"},model:{value:e.floorInfoForm.area,callback:function(t){e.$set(e.floorInfoForm,"area",t)},expression:"floorInfoForm.area"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"上传图片："}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.floorInfoForm.image,expression:"floorInfoForm.image"}],staticClass:"upload-img"},[a("img",{attrs:{src:e.floorInfoForm.image,alt:""}}),a("div",{staticClass:"mask",on:{click:e.handleRemove}},[a("i",{staticClass:"el-icon-delete"})])]),a("el-upload",{directives:[{name:"show",rawName:"v-show",value:!e.floorInfoForm.image,expression:"!floorInfoForm.image"}],ref:"upload",attrs:{action:"/api/file/upload","list-type":"picture-card","http-request":e.customHttpRequest,"on-change":e.customChange,accept:"image/jpeg,image/png,image/jpg","auto-upload":!1,multiple:!1,"show-file-list":!1,limit:1}},[a("i",{staticClass:"el-icon-plus"})])],1)],1)],1)],1),a("div",{staticClass:"card-header"},[a("i",{staticClass:"el-icon-info header-icon"}),a("div",{staticClass:"header-title"},[e._v("已绑定设备")])]),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-table",{attrs:{data:e.bindDeviceList,stripe:"",size:"small"}},[a("el-table-column",{attrs:{prop:"code",label:"设备编码"}}),a("el-table-column",{attrs:{prop:"name",label:"设备名称"}}),a("el-table-column",{attrs:{prop:"typeDetailName",label:"设备类型"}}),a("el-table-column",{attrs:{label:"图片详情"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{staticClass:"img-wrap"},[t.row.image?a("el-image",{staticClass:"img",attrs:{src:t.row.image,fit:"contain"}}):[e._v("\n                暂无图片\n              ")]],2)}}],null,!1,2006623343)}),a("el-table-column",{attrs:{label:"是否有效"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{domProps:{textContent:e._s(!0===t.row.status?"有效":"无效")}})]}}],null,!1,3862004679)})],1)],1),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.closeDialog}},[e._v("取 消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.saveFloor}},[e._v("保 存")])],1)],1)]):e._e()],1)},C=[],D=a("73ec"),_=a("ee8b"),$=a("75fb"),O=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(s["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.method="",e.floorDialogVisible=!1,e.floorTableData=[],e.floorInfoForm={},e.floorFormRules={name:[{required:!0,message:"该选项为必填项",trigger:"change"}],code:[{required:!0,message:"该选项为必填项",trigger:"change"}]},e.pagination={current:1,total:0,size:10,query:{name:"",code:""}},e.dialogImgVisible=!1,e.pageParam={size:"1",current:"10",query:""},e.bindDeviceList=[],e.loading=!1,e}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"getFloorDeviceList",value:function(e){var t=this;this.$http.get(g["a"].getBindDevice+this.buildingId,{params:{floorId:e}}).then((function(e){e.data.status?t.bindDeviceList=e.data.data:t.$message.error(e.data.message)}))}},{key:"getFloorList",value:function(){var e=this;this.$http.post(g["a"].getFloorPaging+"/"+this.buildingId,this.pagination).then((function(t){t.status&&(t.data.status?(e.floorTableData=t.data.data.records,e.pagination.total=t.data.data.total):e.$message.error(t.data.message))}))}},{key:"addFloorForm",value:function(){this.floorDialogVisible=!0,this.floorInfoForm.buildingId=this.buildingId,this.floorInfoForm={},this.bindDeviceList=[]}},{key:"editFloor",value:function(e){this.floorInfoForm=e,this.getFloorDeviceList(this.floorInfoForm.id),this.floorDialogVisible=!0}},{key:"mounted",value:function(){this.getFloorList()}},{key:"closeDialog",value:function(){this.floorInfoForm={},this.floorDialogVisible=!1}},{key:"handleFloorDelete",value:function(e,t){var a=this;_["a"].confirm("是否需要删除该楼层?").then((function(){a.$http.get(g["a"].deleteBuildingFlorr+t.id).then((function(e){e.data.status?(a.$message.success("删除成功！"),a.getFloorList()):a.$message.error(e.data.message)}))}))}},{key:"customHttpRequest",value:function(e){var t=this;this.loading=!0;var a=D["a"].createUploadForm(e.file);this.$http.post(e.action,a.formData,a.config).then((function(e){t.loading=!1,e.data.status?(t.floorInfoForm.image=e.data.data.accessUrl,t.doSubmit()):t.$message.error("图片上传失败")}))}},{key:"customChange",value:function(e,t){var a=Object($["b"])(e.raw),i=a.status,o=a.message;i?(this.$set(this.floorInfoForm,"image",e.url),this.floorInfoForm.needUpload=!0):(this.$message.error(o),this.$refs.upload.handleRemove(e))}},{key:"handleRemove",value:function(){var e=this;this.floorInfoForm.image="",this.$nextTick((function(){e.$refs.upload.clearFiles()}))}},{key:"saveFloor",value:function(){var e=this;this.$refs.floorInfoForm.validate((function(t){t&&(e.loading=!0,e.floorInfoForm.needUpload?(delete e.floorInfoForm.needUpload,e.$refs.upload.submit()):e.doSubmit())}))}},{key:"doSubmit",value:function(){var e=this,t=g["a"].updateFloor;if(null==this.floorInfoForm.id&&(t=g["a"].addFloor),""==this.buildingId)return this.$message.warning("建筑不存在");this.floorInfoForm.buildingId=this.buildingId,this.$http.post(t,this.floorInfoForm).then((function(t){e.loading=!1,t.status&&(t.data.status?(e.$message.success(t.data.message),e.floorDialogVisible=!1,e.getFloorList()):e.$message.error(t.data.message))}))}}]),t}(u["e"]);d["__decorate"]([Object(u["d"])({type:String,required:!0})],O.prototype,"buildingId",void 0),O=d["__decorate"]([Object(u["a"])({})],O);var T=O,z=T,S=(a("67fd"),Object(b["a"])(z,x,C,!1,null,"5b92d9cf",null)),B=S.exports,L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"person-wrapper"},[a("q-title-bar",{attrs:{barTitle:"设备绑定",btnName:"添加设备"},on:{click:e.bindVechcle}}),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-table",{staticStyle:{width:"100%","margin-top":"20px","min-height":"calc(100vh - 315px)"},attrs:{data:e.buildList}},[a("el-table-column",{attrs:{prop:"code",label:"设备编码","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"name",label:"设备名称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"typeDetailName",label:"设备类型","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"图片详情"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{staticClass:"img-wrap"},[t.row.image?a("el-image",{staticClass:"img",attrs:{src:t.row.image,fit:"contain"}}):[e._v("\n            暂无图片\n          ")]],2)}}])}),a("el-table-column",{attrs:{label:"建筑或楼层","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[""!==t.row.floorId||null!=t.row.floorId?a("span",{staticStyle:{color:"#0087cc","font-weight":"bolder"}},[e._v(e._s(t.row.floorName))]):e._e(),""===t.row.floorId?a("span",{staticStyle:{color:"#92cc76","font-weight":"bolder"}},[e._v("建筑")]):e._e()]}}])}),a("el-table-column",{attrs:{label:"是否有效","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{domProps:{textContent:e._s(!0===t.row.status?"有效":"无效")}})]}}])}),a("el-table-column",{attrs:{label:"所处位置","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[null==t.row.floorId||""===t.row.floorId?a("el-switch",{attrs:{"active-text":"室外","inactive-text":"室内","active-value":!0,"inactive-value":!1},on:{change:function(a){return e.changeBindGps(t.row)}},model:{value:t.row.outMark,callback:function(a){e.$set(t.row,"outMark",a)},expression:"scope.row.outMark"}}):e._e(),""!==t.row.floorId&&null!=t.row.floorId?a("span",{staticStyle:{color:"grey"}},[e._v("楼层暂不支持")]):e._e()]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.cancelBind(t.row)}}},[e._v("取消绑定")])]}}])})],1)],1),a("el-dialog",{attrs:{title:"未绑定的设备列表",visible:e.noBindVechcleDialogVisible,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.noBindVechcleDialogVisible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("div",{staticClass:"header"},[a("el-input",{staticStyle:{width:"240px","margin-right":"10px"},attrs:{size:"small",maxlength:100,placeholder:"输入需要查询的设备名称"},on:{blur:e.getNoBindList},model:{value:e.pageParam.query.name,callback:function(t){e.$set(e.pageParam.query,"name",t)},expression:"pageParam.query.name"}}),a("q-search-button",{staticStyle:{"margin-right":"20px"},on:{click:e.getNoBindList}}),a("el-radio-group",{attrs:{size:"small"},on:{change:e.getFloorOption},model:{value:e.bindType,callback:function(t){e.bindType=t},expression:"bindType"}},[a("el-radio-button",{attrs:{label:"建筑"}}),a("el-radio-button",{attrs:{label:"楼层"}})],1),"楼层"===e.bindType?a("el-select",{staticStyle:{"margin-left":"20px",width:"240px"},attrs:{size:"small"},model:{value:e.floorId,callback:function(t){e.floorId=t},expression:"floorId"}},e._l(e.floorOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1):e._e()],1),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.noBindbuildList},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{prop:"code",label:"设备编码","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"name",label:"设备名称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"图片详情"},scopedSlots:e._u([{key:"default",fn:function(t){return a("div",{staticClass:"img-wrap"},[t.row.image?a("el-image",{staticClass:"img",attrs:{src:t.row.image,fit:"contain"}}):[e._v("\n              暂无图片\n            ")]],2)}}])}),a("el-table-column",{attrs:{prop:"typeDetailName",label:"设备类型"}})],1),a("q-pagination",{attrs:{"current-page":e.pageParam.current,"page-sizes":[10,20,30,40],"page-size":e.pageParam.size,layout:"total, sizes, prev, pager, next, jumper",total:e.pageParam.total},on:{"size-change":e.handleSize,"current-change":e.handleCurrent}}),a("div",{staticClass:"dialog-footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.noBindVechcleDialogVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.saveBind}},[e._v("确认")])],1)],1)])],1)},j=[],R=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(s["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.tableHeader={"background-color":"#F8F8F9",color:"#333333","font-size":"14px"},e.buildList=[],e.noBindbuildList=[],e.noBindVechcleDialogVisible=!1,e.selectedDevice=[],e.pageParam={size:10,current:1,total:0,query:{name:""}},e.bindType="建筑",e.floorId="",e.floorOptions=[],e.loading=!1,e}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"handleSelectionChange",value:function(e){this.selectedDevice=e}},{key:"getFloorOption",value:function(){var e=this;"楼层"==this.bindType?this.$http.get(g["a"].getAllFloorList,{params:{buildId:this.buildId}}).then((function(t){t.data.status?e.floorOptions=t.data.data:e.$message.error(t.data.message)})):(this.floorOptions=[],this.floorId="")}},{key:"getNoBindList",value:function(){var e=this;this.pageParam.query.bound=!1,this.$http.post(g["a"].getDevicePaging,this.pageParam).then((function(t){t.data.status?(e.noBindbuildList=t.data.data.records,e.pageParam.total=t.data.data.total):e.$message.error(t.data.message)}))}},{key:"saveBind",value:function(){var e=this;if("楼层"==this.bindType&&""==this.floorId)return this.$message.warning("请选择楼层");if(0==this.selectedDevice.length)return this.$message.warning("请选择设备");this.loading=!0;var t=this.selectedDevice.map((function(t){return{buildingId:e.buildId,floorId:e.floorId,deviceId:t.id,outMark:!1}}));this.$http.post(g["a"].bindDevice+this.buildId,{floorId:this.floorId,devices:t}).then((function(t){e.loading=!1,t.data.status?(e.$message.success("操作成功"),e.noBindVechcleDialogVisible=!1,e.getList()):e.$message.error(t.data.messages)})).catch((function(){e.loading=!1}))}},{key:"getList",value:function(){var e=this;this.$http.get(g["a"].getBindDevice+this.buildId).then((function(t){t.data.status?e.buildList=t.data.data:e.$message.error(t.data.message)}))}},{key:"handleSize",value:function(e){this.pageParam.size=e,this.getNoBindList()}},{key:"handleCurrent",value:function(e){this.pageParam.current=e,this.getNoBindList()}},{key:"cancelBind",value:function(e){var t=this;_["a"].confirm("确认需要取消绑定？").then(Object(I["a"])(regeneratorRuntime.mark((function a(){var i,o,n,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$http.post(g["a"].cancleDevice,{buildingId:t.buildId,floorId:e.floorId,deviceId:e.id,outMark:e.outMark});case 2:i=a.sent,o=i.data,o.data,n=o.status,l=o.message,n?(t.$message.success("操作成功"),t.getList()):t.$message.error(l);case 8:case"end":return a.stop()}}),a)}))))}},{key:"changeBindGps",value:function(e){var t=this;this.$http.get(g["a"].switchPlace+e.relationId,{params:{outMark:e.outMark}}).then((function(a){a.data.status?t.$message.success("已切换为"+(e.outMark?"室外":"室内")):t.$message.error(a.data.status)}))}},{key:"bindVechcle",value:function(){this.floorOptions=[],this.floorId="",this.selectedDevice=[],this.bindType="建筑",this.noBindVechcleDialogVisible=!0,this.pageParam={size:10,current:1,total:0,query:{name:""}},this.getNoBindList()}},{key:"mounted",value:function(){this.getList()}}]),t}(u["e"]);d["__decorate"]([Object(u["d"])({type:String})],R.prototype,"buildId",void 0),R=d["__decorate"]([Object(u["a"])({})],R);var q=R,P=q,M=(a("08bc"),Object(b["a"])(P,L,j,!1,null,"220ef07a",null)),N=M.exports,V=window.AMap,A=window.AMapUI,E=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(s["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.loading=!1,e.customOptions=[],e.detailsForm={},e.detailsFormRules={name:[{required:!0,message:"该选项为必填项",trigger:"change"}],orgId:[{required:!0,message:"该选项为必填项",trigger:"change"}],typeDetailId:[{required:!0,message:"该选项为必填项",trigger:"change"}]},e.orgOptions=[],e.orgVisible=!1,e.typeDetailOptions=[],e.disabled=!1,e.visible=!0,e.typeVisible=!1,e.hasCustomRole=qTouch.getBaseTypeByCode("building"),e.marker=null,e.addressDialog=!1,e.text="建筑物坐标绑定",e.showLeaveChoose=!1,e.zoom=18,e.center=[106.569137124949,29.643814122592],e}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"listRowIdChange",value:function(){this.listRowId&&this.getBuildingInfo(this.listRowId),this.getOrgTree(),this.getTypeDetailTree()}},{key:"switchToList",value:function(){}},{key:"getFilledCustomOptions",value:function(){var e=Object(I["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=this.$refs["custom-input"],!a){e.next=5;break}return e.next=4,a.formValidation();case 4:t=e.sent;case 5:t&&(this.detailsForm.extInfo=t),this.doSave();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"saveInfo",value:function(){var e=this;this.$refs.detailsForm.validate((function(t){t&&(e.detailsForm.needUpload?(e.loading=!0,delete e.detailsForm.needUpload,e.$refs.upload.submit()):e.getFilledCustomOptions())}))}},{key:"getTypeDetailTree",value:function(){this.queryTree(g["a"].findTypeTree+"/building","building")}},{key:"handleTypeChange",value:function(e,t,a){t&&this.$refs.typeTree.setCheckedKeys([e.id])}},{key:"saveType",value:function(){this.$refs.detailsForm.validateField("typeDetailId",(function(){})),this.detailsForm.typeDetailId&&this.changeCustomOptions()}},{key:"getOrgTree",value:function(){this.queryTree(g["a"].getNewOrgTree,"organization")}},{key:"handleOrgChange",value:function(e,t,a){t&&this.$refs.orgTree.setCheckedKeys([e.id])}},{key:"saveOrg",value:function(){}},{key:"queryTree",value:function(e,t){var a=this;this.$http.get(e).then((function(e){e.status&&(e.data.status?(D["a"].removeEmptyChildren(e.data.data),"building"==t&&(a.typeDetailOptions=e.data.data),"organization"==t&&(a.orgOptions=e.data.data)):a.$message.error(e.data.message))}))}},{key:"changeCustomOptions",value:function(){var e=this;this.$http.get(g["a"].getTemplateByTypeDetaiId+"/"+this.detailsForm.typeDetailId).then((function(t){t.data.status?e.customOptions=t.data.data:e.$message.error(t.data.message)}))}},{key:"doSave",value:function(){var e=this;this.loading=!0;var t=g["a"].add;this.listRowId&&(t=g["a"].update),this.$http.post(t,this.detailsForm).then((function(t){t.data.status?(e.$message.success(t.data.message),t.data.data&&e.$emit("update:listRowId",t.data.data),e.switchToList()):e.$message.error(t.data.message)})).finally((function(){e.loading=!1}))}},{key:"customHttpRequest",value:function(e){var t=this;this.loading=!0;var a=D["a"].createUploadForm(e.file);this.$http.post(e.action,a.formData,a.config).then((function(e){t.loading=!1,e.data.status?(t.detailsForm.image=e.data.data.accessUrl,t.doSave()):t.$message.error("图片上传失败")})).finally((function(){t.loading=!1}))}},{key:"customChange",value:function(e,t){var a=Object($["b"])(e.raw),i=a.status,o=a.message;i?(this.$set(this.detailsForm,"image",e.url),this.detailsForm.needUpload=!0):(this.$message.error(o),this.$refs.upload.handleRemove(e))}},{key:"handleRemove",value:function(){var e=this;this.detailsForm.image="",this.$nextTick((function(){e.$refs.upload.clearFiles()}))}},{key:"getBuildingInfo",value:function(e){var t=this;this.loading=!0,this.$http.get(g["a"].getOneById+"/"+e).then((function(e){e.data.status?(t.detailsForm=e.data.data,t.detailsForm.extInfoVO&&(t.customOptions=t.detailsForm.extInfoVO)):t.$message.error(e.data.message)})).finally((function(){t.loading=!1}))}},{key:"bindAddress",value:function(){var e=this;this.addressDialog=!0,this.$nextTick((function(){if(e.detailsForm.location){var t=JSON.parse(e.detailsForm.location);e.initMap(t),e.addBuildMarker(t,e.detailsForm.address),e.showLeaveChoose=!1,e.text="当前建筑绑定坐标为："+e.detailsForm.location}else e.text="请在地图上选取建筑物位置，并双击确定！",e.initMap(e.center),e.chooseSiteOnMap()}))}},{key:"initMap",value:function(e){var t=this;this.map=Object.freeze(new V.Map("buildAmap",{center:e,resizeEnable:!0,zoom:this.zoom,features:["bg","point","road","building"]})),this.map.setMapStyle("amap://styles/7a2258c5592a544ff4242a2d0341ef6c"),A.loadUI(["misc/PoiPicker"],(function(e){var a=new e({input:"buildInput"});t.poiPickerReady(a)}))}},{key:"poiPickerReady",value:function(e){var t=this;window.poiPicker=e;var a=new V.Marker;e.on("poiPicked",(function(e){var i=e.source,o=e.item;o.id,o.name,o.location.toString(),o.formattedAddress;a.setMap(t.map),a.setPosition(o.location),t.map.setCenter(a.getPosition())}))}},{key:"addBuildMarker",value:function(e,t){this.marker=new V.Marker({position:e}),this.marker.setLabel({offset:new V.Pixel(20,-20),content:"<div style='margin: 2px 5px;font-family: PingFang SC;line-height: 16px'>"+t+"</div>"}),this.marker.setMap(this.map)}},{key:"chooseOff",value:function(){this.text="建筑物坐标绑定",this.showLeaveChoose=!1,this.initMap(this.center)}},{key:"chooseSiteOnMap",value:function(){var e=this;this.showLeaveChoose=!0,this.text="请在地图上选取建筑物位置，并双击确定！",this.map.clearMap(),this.map.setDefaultCursor("crosshair"),this.map.on("dblclick",(function(t){var a=[t.lnglat.getLng(),t.lnglat.getLat()];e.text="您选取了 "+JSON.stringify(a)+" 的位置！";var i=new V.Geocoder({radius:1e3,extensions:"all"});i.getAddress(a,(function(t,i){if("complete"===t&&"OK"===i.info){var o=i.regeocode.formattedAddress;e.$prompt("当前选中位置：","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:o}).then((function(t){e.detailsForm.location=JSON.stringify(a),e.detailsForm.address=t.value,e.addressDialog=!1})).catch((function(){e.text="请在地图上选取建筑物位置，并双击确定！"}))}}))}))}},{key:"destroyMap",value:function(){this.map.destroy(),console.log(this.map)}}]),t}(u["e"]);d["__decorate"]([Object(u["d"])({type:String})],E.prototype,"listRowId",void 0),d["__decorate"]([Object(u["f"])("listRowId",{immediate:!0})],E.prototype,"listRowIdChange",null),d["__decorate"]([Object(u["b"])("switch")],E.prototype,"switchToList",null),E=d["__decorate"]([Object(u["a"])({components:{BuildingFloorList:B,BuildingFloorDevice:N}})],E);var U=E,K=U,G=(a("7c1e"),Object(b["a"])(K,k,F,!1,null,"14fbfa2a",null)),H=G.exports,J=function(e){function t(){var e;return Object(n["a"])(this,t),e=Object(s["a"])(this,Object(r["a"])(t).apply(this,arguments)),e.whichComponent="BuildingList",e.listRowId="",e.method="",e}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"switchComponent",value:function(e,t){switch(e){case"back":this.whichComponent="BuildingList";break;case"add":this.whichComponent="BuildingDetails",this.listRowId="";break;case"edit":this.whichComponent="BuildingDetails",this.listRowId=t.id;break;default:this.whichComponent="BuildingList"}}}]),t}(u["e"]);J=d["__decorate"]([Object(u["a"])({components:{BuildingList:w,BuildingDetails:H}})],J);var Q=J,W=Q,X=Object(b["a"])(W,i,o,!1,null,"d7e23b0a",null);t["default"]=X.exports},"67fd":function(e,t,a){"use strict";var i=a("298e"),o=a.n(i);o.a},"75fb":function(e,t,a){"use strict";a.d(t,"d",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return s}));a("3b2b");var i=function(e){var t=new RegExp("^[1][3-9][0-9]{9}$");return t.test(e)},o=function(e){var t="image/jpeg"===e.type,a="image/jpg"===e.type,i="image/png"===e.type,o="image/bmp"===e.type,n=e.size/1024/1024<10;return t||a||i||o?n?{status:!0,message:""}:{status:!1,message:"上传图片大小不能超过 10MB!"}:{status:!1,message:"上传图片必须是/jpg/jpeg/png/bmp格式!"}};function n(e){var t={value:e,unit:"KB"};return e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="MB",e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="GB",e/=1024,e>=1&&(t.value=+e.toFixed(2),t.unit="TB"))),t}function l(e){var t=e.value,a=e.unit;switch(a){case"KB":return Math.floor(t);case"MB":return Math.floor(1024*t);case"GB":return Math.floor(1024*t*1024);case"TB":return Math.floor(1024*t*1024*1024)}}var s=function(e,t){if(console.log(e),t){if(t.formatList&&t.formatList.every((function(t){return e.type!=="image/"+t})))return{status:!1,message:"上传图片必须是/".concat(t.formatList.join("/"),"格式!")};if(t.maxKbSize&&e.size/1024>t.maxKbSize){var a=n(t.maxKbSize);return{status:!1,message:"上传图片大小不能超过 ".concat(a.value).concat(a.unit,"!")}}}return{status:!0,message:""}}},"7c1e":function(e,t,a){"use strict";var i=a("43d6"),o=a.n(i);o.a},"7d19":function(e,t,a){"use strict";var i={findTypeTree:"/admin/typeDetail/findTypeTree",getOrgTreeData:"/admin/organization/orgTree",getNewOrgTree:"/admin/organization/orgTree/building",getTemplateByTypeDetaiId:"/admin/typeDetail/getTemplateByTypeDetaiId",getBuildingList:"/admin/build/getBuildList",getPaging:"/admin/building/paging",add:"/admin/building/add",update:"/admin/building/update",delete:"/admin/building/delete",multipleDelete:"/admin/building/multipleDelete",getOneById:"/admin/building/getOneById",getFloorPaging:"/admin/building/floor/paging",addFloor:"/admin/building/floor/add",updateFloor:"/admin/building/floor/update",getAllFloorList:"/admin/building/floor/all",getBindDevice:"/admin/buildingFloorDevice/listDeviceByBuildingId/buildingId/",bindDevice:"/admin/buildingFloorDevice/bind/",cancleDevice:"/admin/buildingFloorDevice/unbind",getDevicePaging:"/admin/device/pagingDevice",switchPlace:"/admin/buildingFloorDevice/switchPlace/",deleteBuildingFlorr:"/admin/building/floor/delete/",getTypeDetail:"/admin/typeDetail",deleteType:"/admin/typeDetail/delete",saveCustomAttrItems:"/admin/typeDetail/saveCustomAttrItems"};t["a"]=i},bfaa:function(e,t,a){},c477:function(e,t,a){},ee8b:function(e,t,a){"use strict";a("9e1f"),a("450d");var i=a("6ed5"),o=a.n(i),n={confirm:function(e){return new Promise((function(t,a){o.a.confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t()})).catch((function(){a()}))}))}};t["a"]=n}}]);
//# sourceMappingURL=chunk-5e3d846a.363b80b6.js.map