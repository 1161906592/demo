<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="author" content="liuyang">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover">
  <title>valToNum</title>
</head>
<body>
<script>
function valToNum (val) {
  val = String(val);
  let [ index, len, firstIsZero, firstIsMinus, hasPoint ] = [ 0, val.length, false, false, false ];
  while (index < len) {
    let currChar = val[index];
    switch (index) {
      case 0:
        if (!(/[\d\-]/.test(currChar))) { // 第一位数字和-
          return "";
        }
        if (currChar === "0") {
          firstIsZero = true;
        } else if (currChar === "-") {
          firstIsMinus = true;
        }
        break;
      case 1:
        if (currChar === ".") { // 不允许 -.
          if (firstIsMinus) {
            return "-";
          }
          hasPoint = true;
        } else if (firstIsZero && currChar !== ".") { // 只允许 0.
          return "0";
        } else if (!(/[\d]/.test(currChar))) {
          return val.substr(0, index);
        }
        break;
      default:
        if (currChar === ".") {
          if (hasPoint) {
            return val.substr(0, index); // 只有一个小数点
          }
          hasPoint = true;
        } else if (!(/\d/.test(currChar))) {
          return val.substr(0, index);
        }
    }
    index++;
  }
  return val;
}
</script>
</body>
</html>
