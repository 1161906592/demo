!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=0)}([function(e,t,n){"use strict";function o(e,t,{color:n="#000",width:o=2,lineJoin:i="round",isDash:r=!1}={}){if(t.length<2)return;e.beginPath(),e.setLineDash(r?[10,6]:[]);const c=t[0];e.moveTo(c[0],c[1]);for(let n=1;n<t.length;n++){const o=t[n];e.lineTo(o[0],o[1])}e.strokeStyle=n,e.lineWidth=o,e.lineJoin=i,e.stroke()}function i(e,{x:t,y:n,w:o,h:i},{borderColor:r="#999",borderWidth:c=2,color:a="#eaeaea",borderTop:d=!0,borderRight:s=!0,borderBottom:f=!0,borderLeft:l=!0}={}){e.beginPath(),e.setLineDash([]),e.strokeStyle=r,e.lineWidth=c,d&&s&&f&&l?(e.rect(t,n,o,i),e.stroke()):(d&&(e.moveTo(t,n),e.lineTo(t+o,n)),s&&(e.moveTo(t+o,n),e.lineTo(t+o,n+i)),f&&(e.moveTo(t+o,n+i),e.lineTo(t,n+i)),l&&(e.moveTo(t,n+i),e.lineTo(t,n)),e.stroke(),e.moveTo(t,n),e.lineTo(t+o,n),e.lineTo(t+o,n+i),e.lineTo(t,n+i)),e.fillStyle=a,e.fill()}function r(e,{text:t,x:n,y:o},{color:i="#333"}={}){e.beginPath(),e.font="14px bold PingFang-SC-Bold",e.fillStyle=i,e.textAlign="center",e.textBaseline="middle",e.fillText(t,n,o)}function c(e,t){const n={};return e.forEach((e,o)=>{t(n,e,o)}),n}n.r(t);const a=Object.freeze(function(){let e={};let t=1;return Array.from({length:8}).map((n,o)=>{let i=(new Date).getTime()-~~(75*Math.random()*60*1e3);return{name:o+1+"#高炉",planList:Array.from({length:32}).map((n,o)=>{let r=i,c=r+~~(36e4*(Math.random()+.5));i=c+~~(12e4*(Math.random()+.25));let a=function t(){let n=~~(64*Math.random()*64);return e[n]?t():(e[n]=!0,n)}();return{id:t++,name:"铁次A"+(o+1),startTime:r,endTime:c,concatId:a}})}})}()),d=document.getElementById("root"),{ctx:s,offCanvas:f,offCtx:l,width:u,height:x}=function(e){const t=document.createElement("canvas");e.appendChild(t);const n=document.createElement("canvas"),o=t.getContext("2d"),i=n.getContext("2d"),r=n.width=t.width=e.offsetWidth,c=n.height=t.height=e.offsetHeight;return{ctx:o,offCanvas:n,offCtx:i,width:r,height:c}}(d),h=function({width:e,height:t}){return Object.freeze({width:e,height:t,dateRangeMS:108e5,lineSpacePX:100,padding:Object.freeze({left:100,right:40,top:100,bottom:100}),rectHeight:50,splitTime:(new Date).getTime(),scaleSpeed:.04,advanceSpaceTime:9e4,lineDotWidth:8})}({width:u,height:x}),m=function({config:{width:e,padding:t,dateRangeMS:n,rectHeight:o,lineSpacePX:i}}){return{eventToCanvasPoint:function(e){return{x:e.clientX,y:e.clientY}},makeRectByPlan:function(e,n,r,c){const a=e.startTime,d=e.endTime;return{x:(a-r)*c+t.left,y:n*i+t.top-o/2,w:~~((d-a)*c),h:o}}}}({config:h}),y=function({config:{width:e,padding:t,dateRangeMS:n},utils:{makeRectByPlan:o}}){let i=[],r=[];function a(){r=[],i.forEach(e=>{e.planList.forEach(e=>{l(e.concatId)&&r.push(e)})})}let d=1,s=(new Date).getTime()-432e4,f={};function l(e){return f[e]}let u={};function x(){const e=h();u=c(i,(t,n,i)=>{n.planList.forEach(n=>{t[n.id]=o(n,i,s,e)})})}function h(){return(e-t.left-t.right)/n*d}return{setDataList:function(e){i=e,f=c(i,(e,t)=>{t.planList.forEach(t=>{e[t.id]=t})}),x(),a()},getDataList:function(){return i},makeConcatList:a,getConcatList:function(){return r},getPlanById:l,setPlanAtId:function(e,t){f[e]=t},getRectById:function(e){return u[e]},setRectAtId:function(e,t){u[e]=t},makeId2Rect:x,setScale:function(e){d=e},getScale:function(){return d},setStartTime:function(e){s=e},getStartTime:function(){return s},ms2px:h}}({config:h,utils:m});y.setDataList(a);const g=function({ctx:e,offCtx:t,offCanvas:n,config:{splitTime:c,rectHeight:a,width:d,height:s,padding:f,lineSpacePX:l,lineDotWidth:u},utils:{},store:{getDataList:x,getConcatList:h,getPlanById:m,getRectById:y,getStartTime:g,ms2px:p}}){function I(e,{x:t,y:n,w:o,h:d},s){const f=s.startTime,l=s.endTime;if(f<=c&&c<=l){let r={x:t,y:n,w:(c-f)*p(),h:a};i(e,r,{borderRight:!1}),i(e,{x:t+r.w,y:n,w:o-(c-f)*p(),h:a},{borderLeft:!1,color:"orange"})}else f<c?i(e,{x:t,y:n,w:o,h:d}):i(e,{x:t,y:n,w:o,h:d},{color:"orange"});r(e,{text:s.name,x:t+o/2,y:n+d/2})}function v(e,t,n,r){o(e,[[t.x,t.y],[n.x,n.y]],{isDash:!0,color:r});const c=u/2;i(e,{x:t.x-c,y:t.y-c,w:u,h:u},{color:"green",borderColor:"green"}),i(e,{x:n.x-c,y:n.y-c,w:u,h:u},{color:"green",borderColor:"green"})}return{render:function({afterRender:i,forceUpdate:u=!1}={}){e.clearRect(0,0,d,s),u&&(t.clearRect(0,0,d,s),x().forEach((e,n)=>{let i=n*l+f.top;o(t,[[f.left,i],[d-f.right,i]]),r(t,{text:e.name,x:50,y:i})}),function(e,{x:t,y:n,w:o,h:i},r){e.save(),e.rect(t,n,o,i),e.clip(),r(),e.restore()}(t,{x:f.left,y:0,w:d-f.right-f.left,h:s},()=>{x().forEach(e=>{e.planList.forEach(e=>{I(t,y(e.id),e)})}),h().forEach(e=>{let n=m(e.concatId);const o=e.endTime,i=n.startTime;if(o>i)return;let r=y(e.id),d=y(n.id);v(t,{x:r.x+r.w,y:r.y+a/2},{x:d.x,y:d.y+a/2},o>c||i>c?"#f00":"#999")}),function(){const e=(c-g())*p()+f.left;o(t,[[e,0],[e,s]],{color:"#999",isDash:!0})}()})),e.drawImage(n,0,0,d,s),i&&i()},renderPlan:I,renderConcatLine:v}}({ctx:s,offCtx:l,offCanvas:f,config:h,utils:m,store:y});g.render({forceUpdate:!0});const p=function({render:{render:e},store:{setRectAtId:t,setPlanAtId:n,getStartTime:o,ms2px:i,getDataList:r},utils:{makeRectByPlan:c}}){let a=[];return{pushHistory:function(e){a.push(e)},rollback:function(){if(!a.length)return;const d=a.pop();switch(d.type){case"move":!function(a){const d=r();a.forEach(({from:{xIndex:e,yIndex:r,snapshot:a},to:{xIndex:s,yIndex:f}})=>{d[e].planList.splice(r,0,a),d[s].planList.splice(f,1),t(a.id,c(a,e,o(),i())),n(a.id,a)}),e({forceUpdate:!0})}(d.detail)}}}}({render:g,store:y,utils:m});!function({root:e,render:{render:t,renderPlan:n,renderConcatLine:o},ctx:i,config:{padding:r,scaleSpeed:c,lineSpacePX:a,advanceSpaceTime:d,lineDotWidth:s,rectHeight:f},utils:{eventToCanvasPoint:l,makeRectByPlan:u},store:{getScale:x,setScale:h,setStartTime:m,getStartTime:y,makeId2Rect:g,getRectById:p,getPlanById:I,setRectAtId:v,ms2px:T,getDataList:w,getConcatList:L,makeConcatList:b},history:{pushHistory:S,rollback:P},beforeMove:E}){const C=(e.addEventListener("click",R),e.addEventListener("mousewheel",k),e.addEventListener("mousedown",j),document.addEventListener("keydown",D),function(){e.removeEventListener("click",R),e.removeEventListener("mousewheel",k),e.removeEventListener("mousedown",j),document.removeEventListener("keydown",D)});function R(e){const{getRectByPoint:t}=this}function k(e){const{x:n}=l(e),o=T();h(x()+c*(e.wheelDelta>0?1:-1)),x()<=0&&h(.01),m(y()+(n-r.left)*(1/o-1/T())),g(),t({forceUpdate:!0})}function D(e){e.ctrlKey&&"KeyZ"===e.code&&P()}let B=null,M=null,O=null;function j(e){const t=l(e);B=function({x:e,y:t}){const n=function({x:e,y:t}){const n=s/2,o=L();for(let e=0;e<o.length;e++){const t=o[e],r=p(t.id),c={x:r.x+r.w-n,y:r.y+f/2-n,w:s,h:s},a=p(t.concatId),d={x:a.x-n,y:a.y+f/2-n,w:s,h:s};if(i(c))return{id:t.id,endId:t.concatId,point:{x:a.x,y:a.y+f/2}};if(i(d))return{id:t.concatId,startId:t.id,point:{x:r.x+r.w,y:r.y+f/2}}}function i(n){if(e>n.x&&e<n.x+n.w&&t>n.y&&t<n.y+n.h)return!0}}({x:e,y:t});if(n)return n}(t),M=function({x:e,y:t}){if(B)return;const n=H({x:e,y:t});if(n&&(!E||E(I(n.id)))){const o=p(n.id);return{...n,offsetX:e-o.x,offsetY:t-o.y}}}(t),O=function({x:e,y:t}){if(B||M)return;return{x:e,y:t}}(t),document.addEventListener("mousemove",A),document.addEventListener("mouseup",X)}function A(e){(M||O||B)&&(!function(e){if(!O)return;const{x:t}=l(e);m(y()+(O.x-t)/T()),g(),O.x=t}(e),t({afterRender:()=>{!function(e){if(!B)return;B.end?o(i,l(e),B.point,"red"):o(i,B.point,l(e),"red")}(e),function(e){if(!M)return;const t=M.id,o={...p(t)},{x:r,y:c}=l(e);o.x=r-M.offsetX,o.y=c-M.offsetY,n(i,o,I(t))}(e)},forceUpdate:!M||!B}))}function X(e){document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",X),function(e){if(!M)return;const n=w(),o=function(e){const t=w();let{x:n,y:o}=l(e);n-=M.offsetX;let i=~~((o-r.top+a/2)/a);i>=t.length&&(i=t.length-1);const c=t[i].planList;let s=!1,f=0;const u=T();for(;f<c.length;f++){const e=p(c[f].id);if(n<=e.x+e.w+d*u){s=!0,n<e.x&&(f--,s=!1);break}}return{xIndex:i,yIndex:f+1,isOverlay:s}}(e),{xIndex:i,yIndex:c,isOverlay:s}=o,f=I(M.id),{x:h}=l(e),m={...f},g=T(x());f.startTime=(h-M.offsetX-r.left)/g+y(),f.endTime=f.startTime+p(M.id).w/g,v(M.id,u(f,i,y(),T())),n[M.xIndex].planList.splice(M.yIndex,1);let L=c,b=c,P=M.yIndex;if(i===M.xIndex)if(c>M.yIndex){L--;const e=M.yIndex+1;(c===e&&!s||c>e)&&b--}else c<M.yIndex&&P++;s&&b>0&&b--;n[i].planList.splice(L,0,f);const E=function(e,t){const n=[],o=w()[e].planList,i=d;let r=o[t],c=t+1;for(;c<o.length;){const t=o[c];if(t.startTime-r.endTime>=i)break;const a={...t},d=r.endTime-t.startTime+i;t.startTime+=d,t.endTime+=d,n.push({from:{xIndex:e,yIndex:c,snapshot:a},to:{xIndex:e,yIndex:c+1}}),v(t.id,u(t,e,y(),T())),c++,r=t}return n}(i,b);t({forceUpdate:!0}),S({type:"move",detail:E.concat({from:{xIndex:M.xIndex,yIndex:P,snapshot:m},to:{xIndex:i,yIndex:c}})}),M=null}(e),function(e){if(!B)return;const t=H(l(e));if(!t)return;const n=t.id;B.endId?(delete I(B.id).concatId,I(n).concatId=B.endId):I(B.startId).concatId=n;b()}(e),t({forceUpdate:!0})}function H({x:e,y:t}){const n=w();let o=~~((t-r.top+a/2)/a);if(o<n.length){const i=n[o].planList,r=i[0];if(r){const n=p(r.id);if(t>=n.y&&t<=n.y+n.h)for(let t=i.length-1;t>=0;t--){const n=p(i[t].id);if(e<=n.x+n.w&&e>=n.x)return{xIndex:o,yIndex:t,id:i[t].id}}}}}}({root:d,config:h,render:g,ctx:s,dataList:a,utils:m,store:y,history:p})}]);