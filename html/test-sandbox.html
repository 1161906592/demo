<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>test-sandbox</title>
  <style>
  * {
    margin: 0;
    padding: 0;
  }

  iframe {
    display: block;
  }
  </style>
</head>
<body>
<script>
function a() {
  let sum = 0;
  return function add() {
    sum++;
    console.log(sum);
  };
}

let b = a()
let c = a()

b();
b();
b();
c();

// function makeIndexMap (list, props) {
//   if (!Array.isArray(props)) {
//     props = [{ id: props }];
//   }
//   const rootCache = {
//     cache: {},
//     index: 0,
//     children: list
//   };
//   return {
//     get (values) {
//       if (!Array.isArray(values)) {
//         values = [values];
//       }
//       let curCache = rootCache;
//       let i = 0;
//       for (; i < values.length; i++) {
//         const curValue = values[i];
//         let cache = curCache.cache[curValue];
//         if (cache) {
//           curCache = cache;
//           continue;
//         }
//         cache = find(curCache, props[i], curValue);
//         if (cache) {
//           curCache = cache;
//         } else {
//           break;
//         }
//       }
//       if (i === values.length) {
//         return curCache.item;
//       }
//     }
//   };
//
//   function find (cache, prop, value) {
//     while (cache.index < cache.children.length) {
//       const item = cache.children[cache.index];
//       cache.cache[item[prop.id]] = {
//         cache: {},
//         index: 0,
//         children: item[prop.children],
//         item: item
//       };
//       cache.index++;
//       if (item[prop.id] === value) {
//         return cache.cache[item[prop.id]];
//       }
//     }
//   }
// }
//
// function fn (list, props) {
//   if (!Array.isArray(props)) {
//     props = [{ id: props }];
//   }
//   return {
//     get (values) {
//       if (!Array.isArray(values)) {
//         values = [values];
//       }
//       let i = 0;
//       let cuList = list;
//       let curItem;
//       for (; i < values.length; i++) {
//         const curValue = values[i];
//         let item = find(cuList, props[i], curValue);
//         if (item) {
//           cuList = item[props[i].children];
//           curItem = item;
//         } else {
//           break;
//         }
//       }
//       if (i === values.length) {
//         return curItem;
//       }
//     }
//   };
//
//   function find (list, prop, value) {
//     let index = 0;
//     while (index < list.length) {
//       const item = list[index];
//       index++;
//       if (item[prop.id] === value) {
//         return item;
//       }
//     }
//   }
// }
//
// function makeData (flag) {
//   const result = [];
//   for (let i = 0; i < 20; i++) {
//     result.push({
//       id: ~~(Math.random() * 100),
//       // id: i,
//       children: flag ? makeData(false) : []
//     });
//   }
//   return result;
// }
//
// function makeMap(list, fn) {
//   const map = {};
//   list.forEach((item, index) => {
//     fn(map, item, index);
//   });
//   return map;
// }
//
// let data = makeData(true)
// let data1 = JSON.parse(JSON.stringify(data))
// let data2 = JSON.parse(JSON.stringify(data))
//
// const values = []
// for (let i = 0; i < 10; i++) {
//   values.push([~~(Math.random() * 10), ~~(Math.random() * 100)]);
// }
//
// console.log(values);
//
// console.time("a1")
// let map = makeIndexMap(data, [{ id: "id", children: "children" }, { id: "id", children: "children" }]);
// console.timeEnd("a1")
// console.time("b1")
// let map1 = fn(data1, [{ id: "id", children: "children" }, { id: "id", children: "children" }]);
// console.timeEnd("b1")
//
// console.time("c1")
// let map2 = makeMap(data2, (map, item) => {
//   map[item.id] = makeMap(item.children, (map, item) => {
//     map[item.id] = item
//   })
// })
// console.timeEnd("c1")
//
// console.time("a")
// values.forEach((item) => {
//   map.get(item)
// })
// console.timeEnd("a")
//
// console.time("b")
// values.forEach((item) => {
//   map1.get(item)
// })
// console.timeEnd("b")
//
// console.time("c")
// values.forEach((item) => {
//   map2[item[0]]?.[item[1]]
// })
// console.timeEnd("c")
</script>
</body>
</html>
